{
  "url": "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/components/command-line-code-executors.html",
  "title": "Command Line Code Executors — AutoGen",
  "content": "Command line code execution is the simplest form of code execution. Generally speaking, it will save each code block to a file and then execute that file. This means that each code block is executed in a new process. There are two forms of this executor:\n\nDocker (DockerCommandLineCodeExecutor) - this is where all commands are executed in a Docker container\n\nLocal (LocalCommandLineCodeExecutor) - this is where all commands are executed on the host machine\n\nTo use DockerCommandLineCodeExecutor, ensure the autogen-ext[docker] package is installed. For more details, see the Packages Documentation.\n\nThe DockerCommandLineCodeExecutor will create a Docker container and run all commands within that container. The default image that is used is python:3-slim, this can be customized by passing the image parameter to the constructor. If the image is not found locally then the class will try to pull it. Therefore, having built the image locally is enough. The only thing required for this image to be compatible with the executor is to have sh and python installed. Therefore, creating a custom image is a simple and effective way to ensure required system dependencies are available.\n\nYou can use the executor as a context manager to ensure the container is cleaned up after use. Otherwise, the atexit module will be used to stop the container when the program exits.\n\nIf you wish to keep the container around after AutoGen is finished using it for whatever reason (e.g. to inspect the container), then you can set the auto_remove parameter to False when creating the executor. stop_container can also be set to False to prevent the container from being stopped at the end of the execution.\n\nIt is desirable to bundle your application into a Docker image. But then, how do you allow your containerised application to execute code in a different container?\n\nThe recommended approach to this is called “Docker out of Docker”, where the Docker socket is mounted to the main AutoGen container, so that it can spawn and control “sibling” containers on the host. This is better than what is called “Docker in Docker”, where the main container runs a Docker daemon and spawns containers within itself. You can read more about this here.\n\nTo do this you would need to mount the Docker socket into the container running your application. This can be done by adding the following to the docker run command:\n\nThis will allow your application’s container to spawn and control sibling containers on the host.\n\nIf you need to bind a working directory to the application’s container but the directory belongs to your host machine, use the bind_dir parameter. This will allow the application’s container to bind the host directory to the new spawned containers and allow it to access the files within the said directory. If the bind_dir is not specified, it will fallback to work_dir.\n\nThe local version will run code on your local system. Use it with caution.\n\nTo execute code on the host machine, as in the machine running your application, LocalCommandLineCodeExecutor can be used.\n\nIf you want the code to run within a virtual environment created as part of the application’s setup, you can specify a directory for the newly created environment and pass its context to LocalCommandLineCodeExecutor. This setup allows the executor to use the specified virtual environment consistently throughout the application’s lifetime, ensuring isolated dependencies and a controlled runtime environment.\n\nAs we can see, the code has executed successfully, and the installation has been isolated to the newly created virtual environment, without affecting our global environment.",
  "headings": [
    {
      "level": "h1",
      "text": "Command Line Code Executors#",
      "id": ""
    },
    {
      "level": "h2",
      "text": "Docker#",
      "id": ""
    },
    {
      "level": "h3",
      "text": "Inspecting the container#",
      "id": ""
    },
    {
      "level": "h3",
      "text": "Example#",
      "id": ""
    },
    {
      "level": "h3",
      "text": "Combining an Application in Docker with a Docker based executor#",
      "id": ""
    },
    {
      "level": "h2",
      "text": "Local#",
      "id": ""
    },
    {
      "level": "h3",
      "text": "Example#",
      "id": ""
    },
    {
      "level": "h2",
      "text": "Local within a Virtual Environment#",
      "id": ""
    }
  ],
  "code_samples": [
    {
      "code": "from pathlib import Path\n\nfrom autogen_core import CancellationToken\nfrom autogen_core.code_executor import CodeBlock\nfrom autogen_ext.code_executors.docker import DockerCommandLineCodeExecutor\n\nwork_dir = Path(\"coding\")\nwork_dir.mkdir(exist_ok=True)\n\nasync with DockerCommandLineCodeExecutor(work_dir=work_dir) as executor:  # type: ignore\n    print(\n        await executor.execute_code_blocks(\n            code_blocks=[\n                CodeBlock(language=\"python\", code=\"print('Hello, World!')\"),\n            ],\n            cancellation_token=CancellationToken(),\n        )\n    )",
      "language": "python"
    },
    {
      "code": "from pathlib import Path\n\nfrom autogen_core import CancellationToken\nfrom autogen_core.code_executor import CodeBlock\nfrom autogen_ext.code_executors.docker import DockerCommandLineCodeExecutor\n\nwork_dir = Path(\"coding\")\nwork_dir.mkdir(exist_ok=True)\n\nasync with DockerCommandLineCodeExecutor(work_dir=work_dir) as executor:  # type: ignore\n    print(\n        await executor.execute_code_blocks(\n            code_blocks=[\n                CodeBlock(language=\"python\", code=\"print('Hello, World!')\"),\n            ],\n            cancellation_token=CancellationToken(),\n        )\n    )",
      "language": "python"
    },
    {
      "code": "CommandLineCodeResult(exit_code=0, output='Hello, World!\\n', code_file='coding/tmp_code_07da107bb575cc4e02b0e1d6d99cc204.python')",
      "language": "unknown"
    },
    {
      "code": "CommandLineCodeResult(exit_code=0, output='Hello, World!\\n', code_file='coding/tmp_code_07da107bb575cc4e02b0e1d6d99cc204.python')",
      "language": "unknown"
    },
    {
      "code": "-v /var/run/docker.sock:/var/run/docker.sock",
      "language": "unknown"
    },
    {
      "code": "-v /var/run/docker.sock:/var/run/docker.sock",
      "language": "unknown"
    },
    {
      "code": "from pathlib import Path\n\nfrom autogen_core import CancellationToken\nfrom autogen_core.code_executor import CodeBlock\nfrom autogen_ext.code_executors.local import LocalCommandLineCodeExecutor\n\nwork_dir = Path(\"coding\")\nwork_dir.mkdir(exist_ok=True)\n\nlocal_executor = LocalCommandLineCodeExecutor(work_dir=work_dir)\nprint(\n    await local_executor.execute_code_blocks(\n        code_blocks=[\n            CodeBlock(language=\"python\", code=\"print('Hello, World!')\"),\n        ],\n        cancellation_token=CancellationToken(),\n    )\n)",
      "language": "python"
    },
    {
      "code": "from pathlib import Path\n\nfrom autogen_core import CancellationToken\nfrom autogen_core.code_executor import CodeBlock\nfrom autogen_ext.code_executors.local import LocalCommandLineCodeExecutor\n\nwork_dir = Path(\"coding\")\nwork_dir.mkdir(exist_ok=True)\n\nlocal_executor = LocalCommandLineCodeExecutor(work_dir=work_dir)\nprint(\n    await local_executor.execute_code_blocks(\n        code_blocks=[\n            CodeBlock(language=\"python\", code=\"print('Hello, World!')\"),\n        ],\n        cancellation_token=CancellationToken(),\n    )\n)",
      "language": "python"
    },
    {
      "code": "CommandLineCodeResult(exit_code=0, output='Hello, World!\\n', code_file='/home/ekzhu/agnext/python/packages/autogen-core/docs/src/guides/coding/tmp_code_07da107bb575cc4e02b0e1d6d99cc204.py')",
      "language": "unknown"
    },
    {
      "code": "CommandLineCodeResult(exit_code=0, output='Hello, World!\\n', code_file='/home/ekzhu/agnext/python/packages/autogen-core/docs/src/guides/coding/tmp_code_07da107bb575cc4e02b0e1d6d99cc204.py')",
      "language": "unknown"
    },
    {
      "code": "import venv\nfrom pathlib import Path\n\nfrom autogen_core import CancellationToken\nfrom autogen_core.code_executor import CodeBlock\nfrom autogen_ext.code_executors.local import LocalCommandLineCodeExecutor\n\nwork_dir = Path(\"coding\")\nwork_dir.mkdir(exist_ok=True)\n\nvenv_dir = work_dir / \".venv\"\nvenv_builder = venv.EnvBuilder(with_pip=True)\nvenv_builder.create(venv_dir)\nvenv_context = venv_builder.ensure_directories(venv_dir)\n\nlocal_executor = LocalCommandLineCodeExecutor(work_dir=work_dir, virtual_env_context=venv_context)\nawait local_executor.execute_code_blocks(\n    code_blocks=[\n        CodeBlock(language=\"bash\", code=\"pip install matplotlib\"),\n    ],\n    cancellation_token=CancellationToken(),\n)",
      "language": "python"
    },
    {
      "code": "import venv\nfrom pathlib import Path\n\nfrom autogen_core import CancellationToken\nfrom autogen_core.code_executor import CodeBlock\nfrom autogen_ext.code_executors.local import LocalCommandLineCodeExecutor\n\nwork_dir = Path(\"coding\")\nwork_dir.mkdir(exist_ok=True)\n\nvenv_dir = work_dir / \".venv\"\nvenv_builder = venv.EnvBuilder(with_pip=True)\nvenv_builder.create(venv_dir)\nvenv_context = venv_builder.ensure_directories(venv_dir)\n\nlocal_executor = LocalCommandLineCodeExecutor(work_dir=work_dir, virtual_env_context=venv_context)\nawait local_executor.execute_code_blocks(\n    code_blocks=[\n        CodeBlock(language=\"bash\", code=\"pip install matplotlib\"),\n    ],\n    cancellation_token=CancellationToken(),\n)",
      "language": "python"
    },
    {
      "code": "CommandLineCodeResult(exit_code=0, output='', code_file='/Users/gziz/Dev/autogen/python/packages/autogen-core/docs/src/user-guide/core-user-guide/framework/coding/tmp_code_d2a7db48799db3cc785156a11a38822a45c19f3956f02ec69b92e4169ecbf2ca.bash')",
      "language": "unknown"
    },
    {
      "code": "CommandLineCodeResult(exit_code=0, output='', code_file='/Users/gziz/Dev/autogen/python/packages/autogen-core/docs/src/user-guide/core-user-guide/framework/coding/tmp_code_d2a7db48799db3cc785156a11a38822a45c19f3956f02ec69b92e4169ecbf2ca.bash')",
      "language": "unknown"
    }
  ],
  "patterns": [],
  "links": [
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/components/command-line-code-executors.html",
    "https://microsoft.github.io/autogen/stable/index.html",
    "https://microsoft.github.io/autogen/stable/user-guide/agentchat-user-guide/index.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/index.html",
    "https://microsoft.github.io/autogen/stable/user-guide/extensions-user-guide/index.html",
    "https://microsoft.github.io/autogen/stable/user-guide/autogenstudio-user-guide/index.html",
    "https://microsoft.github.io/autogen/stable/reference/index.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/installation.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/quickstart.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/core-concepts/agent-and-multi-agent-application.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/core-concepts/architecture.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/core-concepts/application-stack.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/core-concepts/agent-identity-and-lifecycle.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/core-concepts/topic-and-subscription.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/framework/agent-and-agent-runtime.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/framework/message-and-communication.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/framework/logging.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/framework/telemetry.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/framework/distributed-agent-runtime.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/framework/component-config.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/components/model-clients.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/components/model-context.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/components/tools.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/components/workbench.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/design-patterns/intro.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/design-patterns/concurrent-agents.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/design-patterns/sequential-workflow.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/design-patterns/group-chat.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/design-patterns/handoffs.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/design-patterns/mixture-of-agents.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/design-patterns/multi-agent-debate.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/design-patterns/reflection.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/design-patterns/code-execution-groupchat.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/cookbook/index.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/cookbook/azure-openai-with-aad-auth.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/cookbook/termination-with-intervention.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/cookbook/tool-use-with-intervention.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/cookbook/extracting-results-with-an-agent.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/cookbook/openai-assistant-agent.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/cookbook/langgraph-agent.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/cookbook/llamaindex-agent.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/cookbook/local-llms-ollama-litellm.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/cookbook/instrumenting.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/cookbook/topic-subscription-scenarios.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/cookbook/structured-output-agent.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/cookbook/llm-usage-logger.html",
    "https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/faqs.html",
    "https://microsoft.github.io/autogen/stable/reference/python/autogen_core.html",
    "https://microsoft.github.io/autogen/stable/reference/python/autogen_ext.code_executors.docker.html",
    "https://microsoft.github.io/autogen/stable/reference/python/autogen_ext.code_executors.local.html"
  ]
}