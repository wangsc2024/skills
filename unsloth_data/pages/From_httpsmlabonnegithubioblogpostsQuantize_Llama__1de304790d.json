{
  "title": "From https://mlabonne.github.io/blog/posts/Quantize_Llama_2_models_using_ggml.html",
  "content": "ALLOWED_QUANTS = \\\n{\n    \"not_quantized\"  : \"Recommended. Fast conversion. Slow inference, big files.\",\n    \"fast_quantized\" : \"Recommended. Fast conversion. OK inference, OK file size.\",\n    \"quantized\"      : \"Recommended. Slow conversion. Fast inference, small files.\",\n    \"f32\"     : \"Not recommended. Retains 100% accuracy, but super slow and memory hungry.\",\n    \"f16\"     : \"Fastest conversion + retains 100% accuracy. Slow and memory hungry.\",\n    \"q8_0\"    : \"Fast conversion. High resource use, but generally acceptable.\",\n    \"q4_k_m\"  : \"Recommended. Uses Q6_K for half of the attention.wv and feed_forward.w2 tensors, else Q4_K\",\n    \"q5_k_m\"  : \"Recommended. Uses Q6_K for half of the attention.wv and feed_forward.w2 tensors, else Q5_K\",\n    \"q2_k\"    : \"Uses Q4_K for the attention.vw and feed_forward.w2 tensors, Q2_K for the other tensors.\",\n    \"q3_k_l\"  : \"Uses Q5_K for the attention.wv, attention.wo, and feed_forward.w2 tensors, else Q3_K\",\n    \"q3_k_m\"  : \"Uses Q4_K for the attention.wv, attention.wo, and feed_forward.w2 tensors, else Q3_K\",\n    \"q3_k_s\"  : \"Uses Q3_K for all tensors\",\n    \"q4_0\"    : \"Original quant method, 4-bit.\",\n    \"q4_1\"    : \"Higher accuracy than q4_0 but not as high as q5_0. However has quicker inference than q5 models.\",\n    \"q4_k_s\"  : \"Uses Q4_K for all tensors\",\n    \"q4_k\"    : \"alias for q4_k_m\",\n    \"q5_k\"    : \"alias for q5_k_m\",\n    \"q5_0\"    : \"Higher accuracy, higher resource usage and slower inference.\",\n    \"q5_1\"    : \"Even higher accuracy, resource usage and slower inference.\",\n    \"q5_k_s\"  : \"Uses Q5_K for all tensors\",\n    \"q6_k\"    : \"Uses Q8_K for all tensors\",\n    \"iq2_xxs\" : \"2.06 bpw quantization\",\n    \"iq2_xs\"  : \"2.31 bpw quantization\",\n    \"iq3_xxs\" : \"3.06 bpw quantization\",\n    \"q3_k_xs\" : \"3-bit extra small quantization\",\n}\npython\nmodel.save_pretrained_merged(\"merged_model\", tokenizer, save_method = \"merged_16bit\",)\nbash\napt-get update\napt-get install pciutils build-essential cmake curl libcurl4-openssl-dev -y\ngit clone https://github.com/ggml-org/llama.cpp\ncmake llama.cpp -B llama.cpp/build \\\n    -DBUILD_SHARED_LIBS=OFF -DGGML_CUDA=ON -DLLAMA_CURL=ON\ncmake --build llama.cpp/build --config Release -j --clean-first --target llama-cli llama-mtmd-cli llama-server llama-gguf-split\ncp llama.cpp/build/bin/llama-* llama.cpp\n\npython llama.cpp/convert-hf-to-gguf.py FOLDER --outfile OUTPUT --outtype f16\npython\nmodel.save_pretrained_merged(\"merged_model\", tokenizer, save_method = \"merged_16bit\",)\nbash\napt-get update\napt-get install pciutils build-essential cmake curl libcurl4-openssl-dev -y\ngit clone https://github.com/ggml-org/llama.cpp\ncmake llama.cpp -B llama.cpp/build \\\n    -DBUILD_SHARED_LIBS=OFF -DGGML_CUDA=ON -DLLAMA_CURL=ON\ncmake --build llama.cpp/build --config Release -j --clean-first --target llama-cli llama-mtmd-cli llama-server llama-gguf-split\ncp llama.cpp/build/bin/llama-* llama.cpp\nbash\npython llama.cpp/convert_hf_to_gguf.py merged_model \\\n    --outfile model-F16.gguf --outtype f16 \\\n    --split-max-size 50G\nbash",
  "code_samples": [
    {
      "code": "{% endtab %}\n\n{% tab title=\"Manual Saving\" %}\nFirst save your model to 16bit:",
      "language": "unknown"
    },
    {
      "code": "Then use the terminal and do:\n\n{% code overflow=\"wrap\" %}",
      "language": "unknown"
    },
    {
      "code": "{% endcode %}\n\nOr follow the steps at <https://rentry.org/llama-cpp-conversions#merging-loras-into-a-model> using the model name \"merged\\_model\" to merge to GGUF.\n{% endtab %}\n{% endtabs %}\n\n### Running in Unsloth works well, but after exporting & running on other platforms, the results are poor\n\nYou might sometimes encounter an issue where your model runs and produces good results on Unsloth, but when you use it on another platform like Ollama or vLLM, the results are poor or you might get gibberish, endless/infinite generations *or* repeated output&#x73;**.**\n\n* The most common cause of this error is using an <mark style=\"background-color:blue;\">**incorrect chat template**</mark>**.** Itâ€™s essential to use the SAME chat template that was used when training the model in Unsloth and later when you run it in another framework, such as llama.cpp or Ollama. When inferencing from a saved model, it's crucial to apply the correct template.\n* You must use the correct `eos token`. If not, you might get gibberish on longer generations.\n* It might also be because your inference engine adds an unnecessary \"start of sequence\" token (or the lack of thereof on the contrary) so ensure you check both hypotheses!\n* <mark style=\"background-color:green;\">**Use our conversational notebooks to force the chat template - this will fix most issues.**</mark>\n  * Qwen-3 14B Conversational notebook [**Open in Colab**](https://colab.research.google.com/github/unslothai/notebooks/blob/main/nb/Qwen3_\\(14B\\)-Reasoning-Conversational.ipynb)\n  * Gemma-3 4B Conversational notebook [**Open in Colab**](https://colab.research.google.com/github/unslothai/notebooks/blob/main/nb/Gemma3_\\(4B\\).ipynb)\n  * Llama-3.2 3B Conversational notebook [**Open in Colab**](https://colab.research.google.com/github/unslothai/notebooks/blob/main/nb/Llama3.2_\\(1B_and_3B\\)-Conversational.ipynb)\n  * Phi-4 14B Conversational notebook [**Open in Colab**](https://colab.research.google.com/github/unslothai/notebooks/blob/main/nb/Phi_4-Conversational.ipynb)\n  * Mistral v0.3 7B Conversational notebook [**Open in Colab**](https://colab.research.google.com/github/unslothai/notebooks/blob/main/nb/Mistral_v0.3_\\(7B\\)-Conversational.ipynb)\n  * **More notebooks in our** [**notebooks docs**](https://docs.unsloth.ai/get-started/unsloth-notebooks)\n\n### Saving to GGUF / vLLM 16bit crashes\n\nYou can try reducing the maximum GPU usage during saving by changing `maximum_memory_usage`.\n\nThe default is `model.save_pretrained(..., maximum_memory_usage = 0.75)`. Reduce it to say 0.5 to use 50% of GPU peak memory or lower. This can reduce OOM crashes during saving.\n\n### How do I manually save to GGUF?\n\nFirst save your model to 16bit via:",
      "language": "unknown"
    },
    {
      "code": "Compile llama.cpp from source like below:\n\n{% code overflow=\"wrap\" %}",
      "language": "unknown"
    },
    {
      "code": "{% endcode %}\n\nThen, save the model to F16:",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h3",
      "text": "Running in Unsloth works well, but after exporting & running on other platforms, the results are poor",
      "id": "running-in-unsloth-works-well,-but-after-exporting-&-running-on-other-platforms,-the-results-are-poor"
    },
    {
      "level": "h3",
      "text": "Saving to GGUF / vLLM 16bit crashes",
      "id": "saving-to-gguf-/-vllm-16bit-crashes"
    },
    {
      "level": "h3",
      "text": "How do I manually save to GGUF?",
      "id": "how-do-i-manually-save-to-gguf?"
    }
  ],
  "url": "llms-txt#from-https://mlabonne.github.io/blog/posts/quantize_llama_2_models_using_ggml.html",
  "links": []
}