{
  "title": "LoRA Hot Swapping Guide",
  "content": "### :shaved\\_ice: vLLM LoRA Hot Swapping / Dynamic LoRAs\n\nTo enable LoRA serving for at most 4 LoRAs at 1 time (these are hot swapped / changed), first set the environment flag to allow hot swapping:\n\nThen, serve it with LoRA support:\n\nTo load a LoRA dynamically (set the lora name as well), do:\n\nTo remove it from the pool:\n\nFor example when finetuning with Unsloth:\n\n{% code overflow=\"wrap\" %}\n\nThen after training, we save the LoRAs:\n\nWe can then load the LoRA:\n\n{% code overflow=\"wrap\" %}",
  "code_samples": [
    {
      "code": "export VLLM_ALLOW_RUNTIME_LORA_UPDATING=True",
      "language": "bash"
    },
    {
      "code": "export VLLM_ALLOW_RUNTIME_LORA_UPDATING=True\nvllm serve unsloth/Llama-3.1-8B-Instruct \\\n    --quantization fp8 \\\n    --kv-cache-dtype fp8\n    --gpu-memory-utilization 0.8 \\\n    --max-model-len 65536 \\\n    --enable-lora \\\n    --max-loras 4 \\\n    --max-lora-rank 64",
      "language": "bash"
    },
    {
      "code": "curl -X POST http://localhost:8000/v1/load_lora_adapter \\\n    -H \"Content-Type: application/json\" \\\n    -d '{\n        \"lora_name\": \"LORA_NAME\",\n        \"lora_path\": \"/path/to/LORA\"\n    }'",
      "language": "bash"
    },
    {
      "code": "curl -X POST http://localhost:8000/v1/unload_lora_adapter \\\n    -H \"Content-Type: application/json\" \\\n    -d '{\n        \"lora_name\": \"LORA_NAME\"\n    }'",
      "language": "bash"
    },
    {
      "code": "from unsloth import FastLanguageModel\nimport torch\nmodel, tokenizer = FastLanguageModel.from_pretrained(\n    model_name = \"unsloth/Llama-3.1-8B-Instruct\",\n    max_seq_length = 2048,\n    load_in_4bit = True,\n)\nmodel = FastLanguageModel.get_peft_model(model)",
      "language": "python"
    },
    {
      "code": "model.save_pretrained(\"finetuned_lora\")\ntokenizer.save_pretrained(\"finetuned_lora\")",
      "language": "python"
    },
    {
      "code": "curl -X POST http://localhost:8000/v1/load_lora_adapter \\\n    -H \"Content-Type: application/json\" \\\n    -d '{\n        \"lora_name\": \"LORA_NAME_finetuned_lora\",\n        \"lora_path\": \"finetuned_lora\"\n    }'",
      "language": "bash"
    }
  ],
  "headings": [
    {
      "level": "h3",
      "text": ":shaved\\_ice: vLLM LoRA Hot Swapping / Dynamic LoRAs",
      "id": ":shaved\\_ice:-vllm-lora-hot-swapping-/-dynamic-loras"
    }
  ],
  "url": "llms-txt#lora-hot-swapping-guide",
  "links": []
}