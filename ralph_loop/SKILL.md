---
name: ralph-loop
description: Ralph Loop 自主迭代開發工具。透過多輪迭代讓 AI 自主精進工作，適合需要反覆審查、測試驅動開發、或需要多階段完成的複雜任務。核心概念：持續迭代直到達成完成標準。
---

# Ralph Loop 自主迭代開發工具

透過多輪迭代讓 AI 自主精進工作，直到滿足明確的完成標準。

## Instructions（執行指令）

當使用者呼叫此 skill 時，Claude Code 必須按照以下步驟執行：

### Step 1: 解析參數

從使用者輸入中解析以下參數：

| 參數 | 簡寫 | 說明 | 預設值 |
|------|------|------|--------|
| `--max-iterations` | `-m` | 最大迭代次數 | 10 |
| `--completion-promise` | `-c` | 完成承諾（成功標準） | 必填 |
| `--prompt` | `-p` | 每輪執行的任務 | 必填 |

**參數解析範例**：
```
/ralph-loop --max-iterations 20 --completion-promise "所有測試通過" --prompt "審查並修復程式碼"
```
解析結果：
- MAX_ITERATIONS = 20
- COMPLETION_PROMISE = "所有測試通過"
- TASK_PROMPT = "審查並修復程式碼"

### Step 2: 初始化迴圈

```markdown
## Ralph Loop 啟動

**任務**：{TASK_PROMPT}
**完成承諾**：{COMPLETION_PROMISE}
**最大回合數**：{MAX_ITERATIONS}

---
```

### Step 3: 執行迴圈

對於每個回合 N（從 1 到 MAX_ITERATIONS）：

```markdown
## 回合 {N}/{MAX_ITERATIONS}

### 執行任務
{執行 TASK_PROMPT 中描述的任務}

### 本輪完成項目
- [x] 完成項目 1
- [x] 完成項目 2
- [ ] 待處理項目（下輪處理）

### 當前狀態評估
{評估當前狀態，列出具體數據}

### 完成承諾檢查
**承諾**：{COMPLETION_PROMISE}
**達成狀態**：✅ 已達成 / ❌ 未達成
**原因**：{說明為何達成或未達成}

### 進度
[████████░░] {完成百分比}%
```

### Step 4: 退出條件檢查

每回合結束時檢查：

1. **完成承諾達成** → 立即結束迴圈，輸出成功報告
2. **達到最大回合數** → 結束迴圈，輸出未完成報告
3. **連續 3 回合無進展** → 暫停，詢問使用者是否繼續
4. **遇到無法解決的阻礙** → 暫停，報告問題並等待指示

### Step 5: 輸出最終報告

#### 成功完成時：
```markdown
## Ralph Loop 完成報告

**狀態**：✅ 成功達成完成承諾
**總回合數**：{實際使用的回合數}/{MAX_ITERATIONS}
**完成承諾**：{COMPLETION_PROMISE}

### 執行摘要
{列出每回合完成的主要工作}

### 最終狀態
{當前系統/程式碼的狀態}

### 建議後續步驟
{如有需要的後續工作}
```

#### 未完成時：
```markdown
## Ralph Loop 中斷報告

**狀態**：⚠️ 未達成完成承諾
**已執行回合**：{N}/{MAX_ITERATIONS}
**完成承諾**：{COMPLETION_PROMISE}

### 當前進度
{已完成的工作}

### 剩餘問題
{尚未解決的問題}

### 建議
{如何繼續完成任務}
```

---

## 核心概念

> **每回合執行相同任務，直到達成完成承諾**

Ralph Loop 的本質是迭代精進：
1. 執行任務
2. 評估結果
3. 檢查完成承諾
4. 未達成則繼續下一輪
5. 達成則結束

### 正確 vs 錯誤做法

| 項目 | 正確做法 | 錯誤做法 |
|------|----------|----------|
| 每回合任務 | 相同 | 不同步驟 |
| 完成承諾檢查 | 每回合檢查 | 最後才檢查 |
| 提前結束 | 達成即結束 | 必須用完所有回合 |
| 本質 | 迭代精進 | 順序執行 |

---

## 使用範例

### 範例 1：程式碼品質審查
```
/ralph-loop -m 5 -c "無 lint 錯誤且測試覆蓋率達 80%" -p "審查程式碼品質並修正問題"
```

### 範例 2：Skill 審查與修復
```
/ralph-loop --max-iterations 20 --completion-promise "所有 skill 100% 正常運作" --prompt "審查並測試系統中的 skill，修正未符合預期者"
```

### 範例 3：功能實作
```
/ralph-loop -m 10 -c "所有測試通過且無安全漏洞" -p "實作用戶認證功能並測試"
```

### 範例 4：效能優化
```
/ralph-loop -m 8 -c "回應時間低於 100ms" -p "分析效能瓶頸並優化"
```

---

## 完成承諾設計指南

### 好的完成承諾（可驗證）
- "所有測試通過"
- "TypeScript 編譯無錯誤"
- "覆蓋率達 80%"
- "無 ESLint 警告"
- "所有 API 回應時間 < 200ms"

### 不好的完成承諾（主觀）
- "程式碼品質好"
- "看起來不錯"
- "差不多完成"

---

## 適用場景

| 適合 | 不適合 |
|------|--------|
| 測試驅動開發 | 主觀設計決策 |
| 程式碼重構 | 單次操作 |
| Lint 修正 | 不明確的成功指標 |
| 效能優化 | 需要人工審查 |
| 文檔完善 | 探索性研究 |

---

## 建議回合數

| 任務類型 | 建議回合數 |
|----------|-----------|
| 簡單修正 | 3-5 |
| 中等複雜度 | 5-8 |
| 複雜任務 | 8-15 |
| 大型重構 | 10-20 |

---

## 安全機制

1. **最大回合限制**：防止無限迴圈
2. **無進展檢測**：連續 3 回合無進展則暫停
3. **阻礙報告**：遇到無法解決的問題時主動報告
4. **使用者確認**：重要決策點詢問使用者

---

## Checklist

執行 Ralph Loop 時確認：

- [ ] 已解析所有參數
- [ ] 完成承諾可客觀驗證
- [ ] 每回合執行相同任務
- [ ] 每回合檢查完成承諾
- [ ] 達成即結束（不必用完所有回合）
- [ ] 輸出結構化的進度報告
- [ ] 遇到阻礙立即報告

---

**Ralph Loop** - 讓 AI 透過持續迭代達成高品質輸出
