{
  "title": "Keep our test users from the previous tutorial",
  "content": "VALID_TOKENS = {\n    \"user1-token\": {\"id\": \"user1\", \"name\": \"Alice\"},\n    \"user2-token\": {\"id\": \"user2\", \"name\": \"Bob\"},\n}\n\n@auth.authenticate\nasync def get_current_user(authorization: str | None) -> Auth.types.MinimalUserDict:\n    \"\"\"Our authentication handler from the previous tutorial.\"\"\"\n    assert authorization\n    scheme, token = authorization.split()\n    assert scheme.lower() == \"bearer\"\n\nif token not in VALID_TOKENS:\n        raise Auth.exceptions.HTTPException(status_code=401, detail=\"Invalid token\")\n\nuser_data = VALID_TOKENS[token]\n    return {\n        \"identity\": user_data[\"id\"],\n    }\n\n@auth.on\nasync def add_owner(\n    ctx: Auth.types.AuthContext,  # Contains info about the current user\n    value: dict,  # The resource being created/accessed\n):\n    \"\"\"Make resources private to their creator.\"\"\"\n    # Examples:\n    # ctx: AuthContext(\n    #     permissions=[],\n    #     user=ProxyUser(\n    #         identity='user1',\n    #         is_authenticated=True,\n    #         display_name='user1'\n    #     ),\n    #     resource='threads',\n    #     action='create_run'\n    # )\n    # value:\n    # {\n    #     'thread_id': UUID('1e1b2733-303f-4dcd-9620-02d370287d72'),\n    #     'assistant_id': UUID('fe096781-5601-53d2-b2f6-0d3403f7e9ca'),\n    #     'run_id': UUID('1efbe268-1627-66d4-aa8d-b956b0f02a41'),\n    #     'status': 'pending',\n    #     'metadata': {},\n    #     'prevent_insert_if_inflight': True,\n    #     'multitask_strategy': 'reject',\n    #     'if_not_exists': 'reject',\n    #     'after_seconds': 0,\n    #     'kwargs': {\n    #         'input': {'messages': [{'role': 'user', 'content': 'Hello!'}]},\n    #         'command': None,\n    #         'config': {\n    #             'configurable': {\n    #                 'langgraph_auth_user': ... Your user object...\n    #                 'langgraph_auth_user_id': 'user1'\n    #             }\n    #         },\n    #         'stream_mode': ['values'],\n    #         'interrupt_before': None,\n    #         'interrupt_after': None,\n    #         'webhook': None,\n    #         'feedback_keys': None,\n    #         'temporary': False,\n    #         'subgraphs': False\n    #     }\n    # }\n\n# Does 2 things:\n    # 1. Add the user's ID to the resource's metadata. Each LangGraph resource has a `metadata` dict that persists with the resource.\n    # this metadata is useful for filtering in read and update operations\n    # 2. Return a filter that lets users only see their own resources\n    filters = {\"owner\": ctx.user.identity}\n    metadata = value.setdefault(\"metadata\", {})\n    metadata.update(filters)\n\n# Only let users see their own resources\n    return filters\npython  theme={null}\nfrom langgraph_sdk import get_client",
  "code_samples": [
    {
      "code": "The handler receives two parameters:\n\n1. `ctx` ([AuthContext](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.auth.types.AuthContext)): contains info about the current `user`, the user's `permissions`, the `resource` (\"threads\", \"crons\", \"assistants\"), and the `action` being taken (\"create\", \"read\", \"update\", \"delete\", \"search\", \"create\\_run\")\n2. `value` (`dict`): data that is being created or accessed. The contents of this dict depend on the resource and action being accessed. See [adding scoped authorization handlers](#scoped-authorization) below for information on how to get more tightly scoped access control.\n\nNotice that the simple handler does two things:\n\n1. Adds the user's ID to the resource's metadata.\n2. Returns a metadata filter so users only see resources they own.\n\n## 2. Test private conversations\n\nTest your authorization. If you have set things up correctly, you will see all âœ… messages. Be sure to have your development server running (run `langgraph dev`):",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "2. Test private conversations",
      "id": "2.-test-private-conversations"
    }
  ],
  "url": "llms-txt#keep-our-test-users-from-the-previous-tutorial",
  "links": []
}