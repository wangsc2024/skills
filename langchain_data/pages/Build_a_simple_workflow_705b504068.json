{
  "title": "Build a simple workflow",
  "content": "workflow = (\n    StateGraph(State)\n    .add_node(\"agent\", agent_node)\n    .add_edge(START, \"agent\")\n    .add_edge(\"agent\", END)\n    .compile()\n)\nmermaid  theme={null}\n  graph LR\n      A([Query]) --> B{{Rewrite}}\n      B --> C[(Retrieve)]\n      C --> D((Agent))\n      D --> E([Response])\n  python  theme={null}\n  from typing import TypedDict\n  from pydantic import BaseModel\n  from langgraph.graph import StateGraph, START, END\n  from langchain.agents import create_agent\n  from langchain.tools import tool\n  from langchain_openai import ChatOpenAI, OpenAIEmbeddings\n  from langchain_core.vectorstores import InMemoryVectorStore\n\nclass State(TypedDict):\n      question: str\n      rewritten_query: str\n      documents: list[str]\n      answer: str\n\n# WNBA knowledge base with rosters, game results, and player stats\n  embeddings = OpenAIEmbeddings()\n  vector_store = InMemoryVectorStore(embeddings)\n  vector_store.add_texts([\n      # Rosters\n      \"New York Liberty 2024 roster: Breanna Stewart, Sabrina Ionescu, Jonquel Jones, Courtney Vandersloot.\",\n      \"Las Vegas Aces 2024 roster: A'ja Wilson, Kelsey Plum, Jackie Young, Chelsea Gray.\",\n      \"Indiana Fever 2024 roster: Caitlin Clark, Aliyah Boston, Kelsey Mitchell, NaLyssa Smith.\",\n      # Game results\n      \"2024 WNBA Finals: New York Liberty defeated Minnesota Lynx 3-2 to win the championship.\",\n      \"June 15, 2024: Indiana Fever 85, Chicago Sky 79. Caitlin Clark had 23 points and 8 assists.\",\n      \"August 20, 2024: Las Vegas Aces 92, Phoenix Mercury 84. A'ja Wilson scored 35 points.\",\n      # Player stats\n      \"A'ja Wilson 2024 season stats: 26.9 PPG, 11.9 RPG, 2.6 BPG. Won MVP award.\",\n      \"Caitlin Clark 2024 rookie stats: 19.2 PPG, 8.4 APG, 5.7 RPG. Won Rookie of the Year.\",\n      \"Breanna Stewart 2024 stats: 20.4 PPG, 8.5 RPG, 3.5 APG.\",\n  ])\n  retriever = vector_store.as_retriever(search_kwargs={\"k\": 5})\n\n@tool\n  def get_latest_news(query: str) -> str:\n      \"\"\"Get the latest WNBA news and updates.\"\"\"\n      # Your news API here\n      return \"Latest: The WNBA announced expanded playoff format for 2025...\"\n\nagent = create_agent(\n      model=\"openai:gpt-4o\",\n      tools=[get_latest_news],\n  )\n\nmodel = ChatOpenAI(model=\"gpt-4o\")\n\nclass RewrittenQuery(BaseModel):\n      query: str\n\ndef rewrite_query(state: State) -> dict:\n      \"\"\"Rewrite the user query for better retrieval.\"\"\"\n      system_prompt = \"\"\"Rewrite this query to retrieve relevant WNBA information.\n  The knowledge base contains: team rosters, game results with scores, and player statistics (PPG, RPG, APG).\n  Focus on specific player names, team names, or stat categories mentioned.\"\"\"\n      response = model.with_structured_output(RewrittenQuery).invoke([\n          {\"role\": \"system\", \"content\": system_prompt},\n          {\"role\": \"user\", \"content\": state[\"question\"]}\n      ])\n      return {\"rewritten_query\": response.query}\n\ndef retrieve(state: State) -> dict:\n      \"\"\"Retrieve documents based on the rewritten query.\"\"\"\n      docs = retriever.invoke(state[\"rewritten_query\"])\n      return {\"documents\": [doc.page_content for doc in docs]}\n\ndef call_agent(state: State) -> dict:\n      \"\"\"Generate answer using retrieved context.\"\"\"\n      context = \"\\n\\n\".join(state[\"documents\"])\n      prompt = f\"Context:\\n{context}\\n\\nQuestion: {state['question']}\"\n      response = agent.invoke({\"messages\": [{\"role\": \"user\", \"content\": prompt}]})\n      return {\"answer\": response[\"messages\"][-1].content_blocks}\n\nworkflow = (\n      StateGraph(State)\n      .add_node(\"rewrite\", rewrite_query)\n      .add_node(\"retrieve\", retrieve)\n      .add_node(\"agent\", call_agent)\n      .add_edge(START, \"rewrite\")\n      .add_edge(\"rewrite\", \"retrieve\")\n      .add_edge(\"retrieve\", \"agent\")\n      .add_edge(\"agent\", END)\n      .compile()\n  )\n\nresult = workflow.invoke({\"question\": \"Who won the 2024 WNBA Championship?\"})\n  print(result[\"answer\"])\n  ```\n</Accordion>\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/oss/langchain/multi-agent/custom-workflow.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>",
  "code_samples": [
    {
      "code": "## Example: RAG pipeline\n\nA common use case is combining [retrieval](/oss/python/langchain/retrieval) with an agent. This example builds a WNBA stats assistant that retrieves from a knowledge base and can fetch live news.\n\n<Accordion title=\"Custom RAG workflow\">\n  The workflow demonstrates three types of nodes:\n\n  * **Model node** (Rewrite): Rewrites the user query for better retrieval using [structured output](/oss/python/langchain/structured-output).\n  * **Deterministic node** (Retrieve): Performs vector similarity search â€” no LLM involved.\n  * **Agent node** (Agent): Reasons over retrieved context and can fetch additional information via tools.",
      "language": "unknown"
    },
    {
      "code": "<Tip>\n    You can use LangGraph state to pass information between workflow steps. This allows each part of your workflow to read and update structured fields, making it easy to share data and context across nodes.\n  </Tip>",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "Example: RAG pipeline",
      "id": "example:-rag-pipeline"
    }
  ],
  "url": "llms-txt#build-a-simple-workflow",
  "links": []
}