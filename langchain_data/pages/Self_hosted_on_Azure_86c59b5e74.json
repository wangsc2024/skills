{
  "title": "Self-hosted on Azure",
  "content": "Source: https://docs.langchain.com/langsmith/azure-self-hosted\n\nWhen running LangSmith on [Microsoft Azure](https://azure.microsoft.com/), you can set up in either [full self-hosted](/langsmith/self-hosted) or [hybrid](/langsmith/hybrid) mode. Full self-hosted mode deploys a complete LangSmith platform with observability functionality as well as the option to create agent deployments. Hybrid mode entails just the infrastructure to run agents in a data plane within your cloud, while our SaaS provides the control plane and observability functionality.\n\nThis page provides Azure-specific architecture patterns, service recommendations, and best practices for deploying and operating LangSmith on Azure.\n\n<Note>\n  LangChain provides Terraform modules specifically for Azure to help provision infrastructure for LangSmith. These modules can quickly set up AKS clusters, Azure Database for PostgreSQL, Azure Managed Redis, Blob Storage, and networking resources.\n\nView the [Azure Terraform modules](https://github.com/langchain-ai/terraform/tree/main/modules/azure) for documentation and examples.\n</Note>\n\n## Reference architecture\n\nWe recommend using Azure's managed services to provide a scalable, secure, and resilient platform. The following architecture applies to both self-hosted and hybrid deployments:\n\n<img src=\"https://mintcdn.com/langchain-5e9cc07a/MMsbRrh5gYIlD_3t/langsmith/images/azure-architecture-self-hosted.png?fit=max&auto=format&n=MMsbRrh5gYIlD_3t&q=85&s=6caf1a8e0a0ee6ec54aed913d20cc928\" alt=\"Architecture diagram showing Azure relations to LangSmith services\" data-og-width=\"2196\" width=\"2196\" data-og-height=\"1498\" height=\"1498\" data-path=\"langsmith/images/azure-architecture-self-hosted.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/langchain-5e9cc07a/MMsbRrh5gYIlD_3t/langsmith/images/azure-architecture-self-hosted.png?w=280&fit=max&auto=format&n=MMsbRrh5gYIlD_3t&q=85&s=65df55f16fe13a701f7bcb4de13fc1b7 280w, https://mintcdn.com/langchain-5e9cc07a/MMsbRrh5gYIlD_3t/langsmith/images/azure-architecture-self-hosted.png?w=560&fit=max&auto=format&n=MMsbRrh5gYIlD_3t&q=85&s=b2d6836e4814357b35403be14d35096b 560w, https://mintcdn.com/langchain-5e9cc07a/MMsbRrh5gYIlD_3t/langsmith/images/azure-architecture-self-hosted.png?w=840&fit=max&auto=format&n=MMsbRrh5gYIlD_3t&q=85&s=ad452cb9098444b8b98568d61673f515 840w, https://mintcdn.com/langchain-5e9cc07a/MMsbRrh5gYIlD_3t/langsmith/images/azure-architecture-self-hosted.png?w=1100&fit=max&auto=format&n=MMsbRrh5gYIlD_3t&q=85&s=eabab56a343feebacda46b99b105ff64 1100w, https://mintcdn.com/langchain-5e9cc07a/MMsbRrh5gYIlD_3t/langsmith/images/azure-architecture-self-hosted.png?w=1650&fit=max&auto=format&n=MMsbRrh5gYIlD_3t&q=85&s=4af913faebd21403b188016973274f13 1650w, https://mintcdn.com/langchain-5e9cc07a/MMsbRrh5gYIlD_3t/langsmith/images/azure-architecture-self-hosted.png?w=2500&fit=max&auto=format&n=MMsbRrh5gYIlD_3t&q=85&s=ef70771bf22c73244f9ab88dd6256eea 2500w\" />\n\n* **Client interfaces**: Users interact with LangSmith via a web browser or the LangChain SDK. All traffic terminates at an [Azure Load Balancer](https://azure.microsoft.com/en-us/products/load-balancer/) and is routed to the frontend (NGINX) within the [AKS](https://azure.microsoft.com/en-us/products/kubernetes-service/) cluster before being routed to another service within the cluster if necessary.\n* **Storage services**: The platform requires persistent storage for traces, metadata and caching. On Azure the recommended services are:\n  * <Icon icon=\"database\" /> **[Azure Database for PostgreSQL (Flexible Server)](https://azure.microsoft.com/en-us/products/postgresql/)** for transactional data (e.g., runs, projects). Azure's high-availability options provision a standby replica in another zone; data is synchronously committed to both primary and standby servers. LangSmith requires PostgreSQL version 14 or higher.\n  * <Icon icon=\"database\" /> **[Azure Managed Redis](https://azure.microsoft.com/en-us/products/managed-redis/)** for queues and caching. Best practices include storing small values and breaking large objects into multiple keys, using pipelining to maximize throughput and ensuring the client and server reside in the same region. You can also use [Azure Cache for Redis](https://azure.microsoft.com/en-us/products/cache), running either in single-instance or cluster mode. LangSmith requires Redis OSS version 5 or higher.\n  * <Icon icon=\"chart-line\" /> **ClickHouse** for high-volume analytics of traces. We recommend using an [externally managed ClickHouse solution](/langsmith/self-host-external-clickhouse). If, for security or compliance reasons, that is not an option, deploy a ClickHouse cluster on AKS using the open-source operator. Ensure replication across [availability zones](https://learn.microsoft.com/en-us/azure/reliability/availability-zones-overview) for durability. Clickhouse is not required for a hybrid deployment.\n  * <Icon icon=\"cube\" /> **[Azure Blob Storage](https://azure.microsoft.com/en-us/products/storage/blobs/)** for large artifacts. Use redundant storage configurations such as read-access geo-redundant (RA-GRS) or geo-zone-redundant (RA-GZRS) storage and design applications to read from the secondary region during an outage.\n\n## Compute and networking on Azure\n\n### Azure Kubernetes Service (AKS)\n\n[AKS](https://azure.microsoft.com/en-us/products/kubernetes-service/) is the recommended compute platform for production deployments. This section outlines the key considerations for planning your setup.\n\nUse [Azure CNI](https://learn.microsoft.com/en-us/azure/aks/configure-azure-cni) networking for production clusters. This model integrates the cluster into an existing virtual network, assigns IP addresses to each pod and node, and allows direct connectivity to on-premises or other Azure services. Ensure the subnet has enough IPs for nodes and pods, avoid overlapping address ranges and allocate additional IP space for scale-out events.\n\n#### Ingress and load balancing\n\nUse Kubernetes Ingress resources and controllers to distribute HTTP/HTTPS traffic. Ingress controllers operate at layer 7 and can route traffic based on URL paths and handle TLS termination. They reduce the number of public IP addresses compared to layer-4 load balancers. Use the [application routing add-on](https://learn.microsoft.com/en-us/azure/aks/app-routing) for managed NGINX ingress controllers integrated with [Azure DNS](https://azure.microsoft.com/en-us/products/dns/) and [Key Vault](https://azure.microsoft.com/en-us/products/key-vault/) for SSL certificates.\n\n#### Web Application Firewall (WAF)\n\nFor additional protection against attacks, deploy a [WAF](https://learn.microsoft.com/en-us/azure/web-application-firewall/overview) such as [Azure Application Gateway](https://azure.microsoft.com/en-us/products/application-gateway/). A WAF filters traffic using OWASP rules and can terminate TLS before the traffic reaches your AKS cluster.\n\n#### Network policies\n\nApply [Kubernetes network policies](https://learn.microsoft.com/en-us/azure/aks/use-network-policies) to restrict pod-to-pod traffic and reduce the impact of compromised workloads. Enable network policy support when creating the cluster and design rules based on application connectivity.\n\n#### High availability\n\nConfigure node pools across [availability zones](https://learn.microsoft.com/en-us/azure/reliability/availability-zones-overview) and use Pod Disruption Budgets (PDB) and multiple replicas for all deployments. Set pod resource requests and limits; the [AKS resource management best practices](https://learn.microsoft.com/en-us/azure/aks/developer-best-practices-resource-management) recommend setting CPU and memory limits to prevent pods from consuming all resources. Use [Cluster Autoscaler](https://learn.microsoft.com/en-us/azure/aks/cluster-autoscaler) and [Vertical Pod Autoscaler](https://learn.microsoft.com/en-us/azure/aks/vertical-pod-autoscaler) to scale node pools and adjust pod resources automatically.\n\n### Networking and identity\n\n#### Virtual network integration\n\nDeploy AKS into its own [virtual network](https://azure.microsoft.com/en-us/products/virtual-network/) and create separate subnets for the cluster, database, Redis, and storage endpoints. Use [Private Link](https://azure.microsoft.com/en-us/products/private-link/) and [service endpoints](https://learn.microsoft.com/en-us/azure/virtual-network/virtual-network-service-endpoints-overview) to keep traffic within your virtual network and avoid exposure to the public internet.\n\nIntegrate LangSmith with [Microsoft Entra ID](https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id) (Azure AD) for single sign-on. Use Azure AD OAuth2 for bearer tokens and assign roles to control access to the UI and API.\n\n## Storage and data services\n\n### Azure Database for PostgreSQL\n\n#### High availability\n\nUse [Flexible Server](https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/overview) with high-availability mode. Azure provisions a standby replica either within the same availability zone (zonal) or across zones (zone-redundant). Data is synchronously committed to both the primary and standby servers, ensuring that committed data is not lost. Zone-redundant configurations place the standby in a different zone to protect against zone outages but may add write latency.\n\n#### Backups and disaster recovery\n\nEnable [automatic backups](https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/concepts-backup-restore) and configure geo-redundant backup storage to protect against region-wide outages. For critical applications, create read replicas in a secondary region.\n\nChoose an appropriate SKU that matches your workload; Flexible Server allows scaling compute and storage independently. Monitor metrics and configure alerts through [Azure Monitor](https://azure.microsoft.com/en-us/products/monitor/).\n\n### Azure Managed Redis\n\n#### Persistence and redundancy\n\nChoose a tier that provides replication and persistence. Configure Redis persistence or data backup for durability. For high-availability, use [active geo-replication](https://learn.microsoft.com/en-us/azure/redis/how-to-active-geo-replication) or zone-redundant caches depending on the tier.\n\n### ClickHouse on Azure\n\nClickHouse is used for analytical workloads (traces and feedback). If you cannot use an externally managed solution, deploy a ClickHouse cluster on AKS using Helm or the official operator. For resilience, replicate data across nodes and availability zones. Consider using [Azure Disks](https://azure.microsoft.com/en-us/products/storage/disks/) for local storage and mount them as StatefulSets.\n\n### Azure Blob Storage\n\nChoose a redundancy configuration based on your recovery objectives. Use [read-access geo-redundant (RA-GRS) or geo-zone-redundant (RA-GZRS) storage](https://learn.microsoft.com/en-us/azure/storage/common/storage-redundancy) and design applications to switch reads to the secondary region during a primary region outage.\n\n#### Naming and partitioning\n\nUse naming conventions that improve load balancing across partitions and plan for the maximum number of concurrent clients. Stay within Azure's scalability and capacity targets and partition data across multiple storage accounts if necessary.\n\nAccess blob storage through [private endpoints](https://learn.microsoft.com/en-us/azure/storage/common/storage-private-endpoints) or by using SAS tokens and CORS rules to enable direct client access.\n\n## Security and access control\n\n#### Separate vaults per application and environment\n\nStore secrets such as database connection strings and API keys in [Azure Key Vault](https://azure.microsoft.com/en-us/products/key-vault/). Use a dedicated vault for each application and environment (dev, test, prod) to limit the impact of a security breach.\n\nUse the [RBAC permission model](https://learn.microsoft.com/en-us/azure/key-vault/general/rbac-guide) to assign roles at the vault scope and restrict access to required principals. Restrict network access using Private Link and firewalls.\n\n#### Data protection and logging\n\nEnable [soft delete and purge protection](https://learn.microsoft.com/en-us/azure/key-vault/general/soft-delete-overview) to prevent accidental deletion. Turn on logging and configure alerts for Key Vault access events.\n\n#### Ingress isolation\n\nExpose only the frontend service through the ingress controller or WAF. Other services should be internal and communicate through cluster networking.\n\n#### RBAC and pod security\n\nUse [Kubernetes RBAC](https://kubernetes.io/docs/reference/access-authn-authz/rbac/) to control who can deploy, modify, or read resources. Enable [pod security admission](https://kubernetes.io/docs/concepts/security/pod-security-admission/) to enforce baseline, restricted, or privileged profiles.\n\n#### Secrets management\n\nMount secrets from Key Vault into pods using [CSI Secret Store](https://learn.microsoft.com/en-us/azure/aks/csi-secrets-store-driver). Avoid storing secrets in environment variables or configuration files.\n\n## Observability and monitoring\n\nConfigure your LangSmith instance to [export telemetry data](/langsmith/export-backend) so you can use Azure's services to monitor it.\n\nUse [Azure Monitor](https://azure.microsoft.com/en-us/products/monitor/) for metrics, logs, and alerting. Proactive monitoring involves configuring alerts on key signals like node CPU/memory utilization, pod status, and service latency. Azure Monitor alerts notify you when predefined thresholds are exceeded.\n\n### Managed Prometheus and Grafana\n\nEnable [Azure Monitor managed Prometheus](https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/prometheus-metrics-overview) to collect Kubernetes metrics. Combine it with [Grafana dashboards](https://azure.microsoft.com/en-us/products/managed-grafana/) for visualization. Define service-level objectives (SLOs) and configure alerts accordingly.\n\n### Container Insights\n\nInstall [Container Insights](https://learn.microsoft.com/en-us/azure/azure-monitor/containers/container-insights-overview) to capture logs and metrics from AKS nodes and pods. Use [Azure Log Analytics workspaces](https://learn.microsoft.com/en-us/azure/azure-monitor/logs/log-analytics-overview) to query and analyze logs.\n\n### Application logging\n\nEnsure LangSmith services emit logs to stdout/stderr and forward them via [Fluent Bit](https://fluentbit.io/) or the Azure Monitor agent.\n\n## Continuous integration\n\n* The preferred method to manage [LangSmith deployments](/langsmith/deployments) is to create a CI process that builds [Agent Server](/langsmith/agent-server) images and pushes them to [Azure Container Registry](https://azure.microsoft.com/en-us/products/container-registry). Create a test deployment for pull requests before deploying a new revision to staging or production upon PR merge.\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/langsmith/azure-self-hosted.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>",
  "code_samples": [],
  "headings": [
    {
      "level": "h2",
      "text": "Reference architecture",
      "id": "reference-architecture"
    },
    {
      "level": "h2",
      "text": "Compute and networking on Azure",
      "id": "compute-and-networking-on-azure"
    },
    {
      "level": "h3",
      "text": "Azure Kubernetes Service (AKS)",
      "id": "azure-kubernetes-service-(aks)"
    },
    {
      "level": "h3",
      "text": "Networking and identity",
      "id": "networking-and-identity"
    },
    {
      "level": "h2",
      "text": "Storage and data services",
      "id": "storage-and-data-services"
    },
    {
      "level": "h3",
      "text": "Azure Database for PostgreSQL",
      "id": "azure-database-for-postgresql"
    },
    {
      "level": "h3",
      "text": "Azure Managed Redis",
      "id": "azure-managed-redis"
    },
    {
      "level": "h3",
      "text": "ClickHouse on Azure",
      "id": "clickhouse-on-azure"
    },
    {
      "level": "h3",
      "text": "Azure Blob Storage",
      "id": "azure-blob-storage"
    },
    {
      "level": "h2",
      "text": "Security and access control",
      "id": "security-and-access-control"
    },
    {
      "level": "h3",
      "text": "Azure Key Vault",
      "id": "azure-key-vault"
    },
    {
      "level": "h3",
      "text": "Network security",
      "id": "network-security"
    },
    {
      "level": "h2",
      "text": "Observability and monitoring",
      "id": "observability-and-monitoring"
    },
    {
      "level": "h3",
      "text": "Azure Monitor",
      "id": "azure-monitor"
    },
    {
      "level": "h3",
      "text": "Managed Prometheus and Grafana",
      "id": "managed-prometheus-and-grafana"
    },
    {
      "level": "h3",
      "text": "Container Insights",
      "id": "container-insights"
    },
    {
      "level": "h3",
      "text": "Application logging",
      "id": "application-logging"
    },
    {
      "level": "h2",
      "text": "Continuous integration",
      "id": "continuous-integration"
    }
  ],
  "url": "llms-txt#self-hosted-on-azure",
  "links": []
}