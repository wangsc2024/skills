{
  "title": "Troubleshooting",
  "content": "Source: https://docs.langchain.com/langsmith/troubleshooting\n\nThis guide will walk you through common issues you may encounter when running a self-hosted instance of LangSmith.\n\nWhile running LangSmith, you may encounter unexpected 500 errors, slow performance, or other issues. This guide will help you diagnose and resolve these issues.\n\n## Getting helpful information\n\nTo diagnose and resolve an issue, you will first need to retrieve some relevant information. The following sections explain how to do this for a Kubernetes or a Docker setup, and how to pull helpful browser information.\n\nGenerally, the main services you will want to analyze are the:\n\n* `langsmith-backend`: Handles CRUD API requests, business logic, requests from the frontend and SDK, trace preparation for ingestion, and the hub API.\n* `langsmith-platform-backend`: Handles authentication, run ingestion, and other high-volume tasks.\n* `langsmith-queue`: Handles incoming traces and feedback, asynchronous ingestion and persistence into the datastore, data integrity checks, and retries during database errors or connection issues.\n\nFor more details on these services, refer to the [Architectural overview](/langsmith/architectural-overview).\n\nThe first step in troubleshooting is to gather important debugging information about your LangSmith deployment. Service logs, kubernetes events, and resource utilization of containers can help identify the root cause of an issue.\n\nYou can run our [k8s troubleshooting script](https://github.com/langchain-ai/helm/blob/main/charts/langsmith/scripts/get_k8s_debugging_info.sh) which will pull all of the relevant kubernetes information and output it to a folder for investigation. The script also compresses this folder into a zip file for sharing. Here is an example of how to run this script, assuming your langsmith deployment was brought up in a `langsmith` namespace:\n\nYou can then inspect the contents of the produced folder for any relevant errors or information. If you would like the LangSmith team to assist in debugging, please share this zip file with the team.\n\nIf running on Docker, you can check the logs your deployment by running the following command:\n\nIf you are experiencing an issue that surfaces as a browser error, it may also be helpful to inspect a HAR file which may include key information. To get the HAR file, you can follow [this guide](https://support.langchain.com/articles/9042697994-how-to-generate-a-har-file-for-troubleshooting) which explains the short process for various browsers.\n\nYou can then use [Google's HAR analyzer](https://toolbox.googleapps.com/apps/har_analyzer/) to investigate. You can also send your HAR file to the LangSmith team to help with debugging.\n\n### *DB::Exception: Cannot reserve 1.00 MiB, not enough space: While executing WaitForAsyncInsert. (NOT\\_ENOUGH\\_SPACE)*\n\nThis error occurs when ClickHouse runs out of disk space. You will need to increase the disk space available to ClickHouse.\n\nIn Kubernetes, you will need to increase the size of the ClickHouse PVC. To achieve this, you can perform the following steps:\n\n1. Get the storage class of the PVC: `kubectl get pvc data-langsmith-clickhouse-0 -n <namespace> -o jsonpath='{.spec.storageClassName}'`\n\n2. Ensure the storage class has AllowVolumeExpansion: true: `kubectl get sc <storage-class-name> -o jsonpath='{.allowVolumeExpansion}'`\n\n* If it is false, some storage classes can be updated to allow volume expansion.\n   * To update the storage class, you can run `kubectl patch sc <storage-class-name> -p '{\"allowVolumeExpansion\": true}'`\n   * If this fails, you may need to create a new storage class with the correct settings.\n\n3. Edit your pvc to have the new size: `kubectl edit pvc data-langsmith-clickhouse-0 -n <namespace>` or `kubectl patch pvc data-langsmith-clickhouse-0 '{\"spec\":{\"resources\":{\"requests\":{\"storage\":\"100Gi\"}}}}' -n <namespace>`\n\n4. Update your helm chart `langsmith_config.yaml` to new size(e.g `100 Gi`)\n\n5. Delete the clickhouse statefulset `kubectl delete statefulset langsmith-clickhouse --cascade=orphan -n <namespace>`\n\n6. Apply helm chart with updated size (You can follow the upgrade guide [here](/langsmith/self-host-upgrades))\n\n7. Your pvc should now have the new size. Verify by running `kubectl get pvc` and `kubectl exec langsmith-clickhouse-0 -- bash -c \"df\"`\n\nIn Docker, you will need to increase the size of the ClickHouse volume. To achieve this, you can perform the following steps:\n\n1. Stop your instance of LangSmith. `docker compose down`\n2. If using bind mount, you will need to increase the size of the mount point.\n3. If using a docker `volume`, you will need to allocate more space to the volume/docker.\n\n### *error: Dirty database version 'version'. Fix and force version*\n\nThis error occurs when the ClickHouse database is in an inconsistent state with our migrations. You will need to reset to an earlier database version and then rerun your upgrade/migrations.\n\n1. Force migration to an earlier version, where version = dirty version - 1.\n\n1. Rerun your upgrade/migrations.\n\n1. Force migration to an earlier version, where version = dirty version - 1.\n\n1. Rerun your upgrade/migrations.\n\n### *413 - Request Entity Too Large*\n\nThis error occurs when the request size exceeds the maximum allowed size. You will need to increase the maximum request size in your Nginx configuration.\n\n1. Edit your `langsmith_config.yaml` and increase the `frontend.maxBodySize` [value](https://github.com/langchain-ai/helm/blob/main/charts/langsmith/values.yaml#L519). This might look something like this:\n\n2. Apply your changes to the cluster.\n\n### *Details: code: 497, message: default: Not enough privileges. To execute this query, it's necessary to have the grant CREATE ROW POLICY ON default.feedbacks\\_rmt*\n\nThis error occurs when your user does not have the necessary permissions to create row policies in Clickhouse. When deploying the Docker deployment, you need to copy the `users.xml` file from the github repo as well. This adds the `<access_management>` tag to the `users.xml` file, which allows the user to create row policies. Below is the default `users.xml` file that we expect to be used.\n\nIn some environments, your mount point may not be writable by the container. In these cases we suggest building a custom image with the `users.xml` file included.\n\nExample `Dockerfile`:\n\nThen take the following steps:\n\n1. Build your custom image.\n\n2. Update your `docker-compose.yaml` to use the custom image. Make sure to remove the users.xml mount point.\n\n3. Restart your instance of LangSmith.\n\n### *ClickHouse fails to start up when running a cluster with AquaSec*\n\nIn some environments, AquaSec may prevent ClickHouse from starting up correctly. This may manifest as the ClickHouse pod not emitting any logs and failing to get marked as ready.\nGenerally this is due to `LD_PRELOAD` being set by AquaSec, which interferes with ClickHouse. To resolve this, you can add the following environment variable to your ClickHouse deployment:\n\nEdit your `langsmith_config.yaml` (or corresponding config file) and set the `AQUA_SKIP_LD_PRELOAD` environment variable:\n\nEdit your `docker-compose.yaml` and set the `AQUA_SKIP_LD_PRELOAD` environment variable:\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/langsmith/troubleshooting.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>",
  "code_samples": [
    {
      "code": "You can then inspect the contents of the produced folder for any relevant errors or information. If you would like the LangSmith team to assist in debugging, please share this zip file with the team.\n\n#### Docker\n\nIf running on Docker, you can check the logs your deployment by running the following command:",
      "language": "unknown"
    },
    {
      "code": "#### Browser Errors\n\nIf you are experiencing an issue that surfaces as a browser error, it may also be helpful to inspect a HAR file which may include key information. To get the HAR file, you can follow [this guide](https://support.langchain.com/articles/9042697994-how-to-generate-a-har-file-for-troubleshooting) which explains the short process for various browsers.\n\nYou can then use [Google's HAR analyzer](https://toolbox.googleapps.com/apps/har_analyzer/) to investigate. You can also send your HAR file to the LangSmith team to help with debugging.\n\n## Common issues\n\n### *DB::Exception: Cannot reserve 1.00 MiB, not enough space: While executing WaitForAsyncInsert. (NOT\\_ENOUGH\\_SPACE)*\n\nThis error occurs when ClickHouse runs out of disk space. You will need to increase the disk space available to ClickHouse.\n\n#### Kubernetes\n\nIn Kubernetes, you will need to increase the size of the ClickHouse PVC. To achieve this, you can perform the following steps:\n\n1. Get the storage class of the PVC: `kubectl get pvc data-langsmith-clickhouse-0 -n <namespace> -o jsonpath='{.spec.storageClassName}'`\n\n2. Ensure the storage class has AllowVolumeExpansion: true: `kubectl get sc <storage-class-name> -o jsonpath='{.allowVolumeExpansion}'`\n\n   * If it is false, some storage classes can be updated to allow volume expansion.\n   * To update the storage class, you can run `kubectl patch sc <storage-class-name> -p '{\"allowVolumeExpansion\": true}'`\n   * If this fails, you may need to create a new storage class with the correct settings.\n\n3. Edit your pvc to have the new size: `kubectl edit pvc data-langsmith-clickhouse-0 -n <namespace>` or `kubectl patch pvc data-langsmith-clickhouse-0 '{\"spec\":{\"resources\":{\"requests\":{\"storage\":\"100Gi\"}}}}' -n <namespace>`\n\n4. Update your helm chart `langsmith_config.yaml` to new size(e.g `100 Gi`)\n\n5. Delete the clickhouse statefulset `kubectl delete statefulset langsmith-clickhouse --cascade=orphan -n <namespace>`\n\n6. Apply helm chart with updated size (You can follow the upgrade guide [here](/langsmith/self-host-upgrades))\n\n7. Your pvc should now have the new size. Verify by running `kubectl get pvc` and `kubectl exec langsmith-clickhouse-0 -- bash -c \"df\"`\n\n#### Docker\n\nIn Docker, you will need to increase the size of the ClickHouse volume. To achieve this, you can perform the following steps:\n\n1. Stop your instance of LangSmith. `docker compose down`\n2. If using bind mount, you will need to increase the size of the mount point.\n3. If using a docker `volume`, you will need to allocate more space to the volume/docker.\n\n### *error: Dirty database version 'version'. Fix and force version*\n\nThis error occurs when the ClickHouse database is in an inconsistent state with our migrations. You will need to reset to an earlier database version and then rerun your upgrade/migrations.\n\n#### Kubernetes\n\n1. Force migration to an earlier version, where version = dirty version - 1.",
      "language": "unknown"
    },
    {
      "code": "1. Rerun your upgrade/migrations.\n\n#### Docker\n\n1. Force migration to an earlier version, where version = dirty version - 1.",
      "language": "unknown"
    },
    {
      "code": "1. Rerun your upgrade/migrations.\n\n### *413 - Request Entity Too Large*\n\nThis error occurs when the request size exceeds the maximum allowed size. You will need to increase the maximum request size in your Nginx configuration.\n\n#### Kubernetes\n\n1. Edit your `langsmith_config.yaml` and increase the `frontend.maxBodySize` [value](https://github.com/langchain-ai/helm/blob/main/charts/langsmith/values.yaml#L519). This might look something like this:",
      "language": "unknown"
    },
    {
      "code": "2. Apply your changes to the cluster.\n\n### *Details: code: 497, message: default: Not enough privileges. To execute this query, it's necessary to have the grant CREATE ROW POLICY ON default.feedbacks\\_rmt*\n\nThis error occurs when your user does not have the necessary permissions to create row policies in Clickhouse. When deploying the Docker deployment, you need to copy the `users.xml` file from the github repo as well. This adds the `<access_management>` tag to the `users.xml` file, which allows the user to create row policies. Below is the default `users.xml` file that we expect to be used.",
      "language": "unknown"
    },
    {
      "code": "In some environments, your mount point may not be writable by the container. In these cases we suggest building a custom image with the `users.xml` file included.\n\nExample `Dockerfile`:",
      "language": "unknown"
    },
    {
      "code": "Then take the following steps:\n\n1. Build your custom image.",
      "language": "unknown"
    },
    {
      "code": "2. Update your `docker-compose.yaml` to use the custom image. Make sure to remove the users.xml mount point.",
      "language": "unknown"
    },
    {
      "code": "3. Restart your instance of LangSmith.",
      "language": "unknown"
    },
    {
      "code": "### *ClickHouse fails to start up when running a cluster with AquaSec*\n\nIn some environments, AquaSec may prevent ClickHouse from starting up correctly. This may manifest as the ClickHouse pod not emitting any logs and failing to get marked as ready.\nGenerally this is due to `LD_PRELOAD` being set by AquaSec, which interferes with ClickHouse. To resolve this, you can add the following environment variable to your ClickHouse deployment:\n\n#### Kubernetes\n\nEdit your `langsmith_config.yaml` (or corresponding config file) and set the `AQUA_SKIP_LD_PRELOAD` environment variable:",
      "language": "unknown"
    },
    {
      "code": "#### Docker\n\nEdit your `docker-compose.yaml` and set the `AQUA_SKIP_LD_PRELOAD` environment variable:",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "Getting helpful information",
      "id": "getting-helpful-information"
    },
    {
      "level": "h2",
      "text": "Common issues",
      "id": "common-issues"
    },
    {
      "level": "h3",
      "text": "*DB::Exception: Cannot reserve 1.00 MiB, not enough space: While executing WaitForAsyncInsert. (NOT\\_ENOUGH\\_SPACE)*",
      "id": "*db::exception:-cannot-reserve-1.00-mib,-not-enough-space:-while-executing-waitforasyncinsert.-(not\\_enough\\_space)*"
    },
    {
      "level": "h3",
      "text": "*error: Dirty database version 'version'. Fix and force version*",
      "id": "*error:-dirty-database-version-'version'.-fix-and-force-version*"
    },
    {
      "level": "h3",
      "text": "*413 - Request Entity Too Large*",
      "id": "*413---request-entity-too-large*"
    },
    {
      "level": "h3",
      "text": "*Details: code: 497, message: default: Not enough privileges. To execute this query, it's necessary to have the grant CREATE ROW POLICY ON default.feedbacks\\_rmt*",
      "id": "*details:-code:-497,-message:-default:-not-enough-privileges.-to-execute-this-query,-it's-necessary-to-have-the-grant-create-row-policy-on-default.feedbacks\\_rmt*"
    },
    {
      "level": "h3",
      "text": "*ClickHouse fails to start up when running a cluster with AquaSec*",
      "id": "*clickhouse-fails-to-start-up-when-running-a-cluster-with-aquasec*"
    }
  ],
  "url": "llms-txt#troubleshooting",
  "links": []
}