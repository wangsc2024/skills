{
  "title": "LangSmith-managed ClickHouse",
  "content": "Source: https://docs.langchain.com/langsmith/langsmith-managed-clickhouse\n\n<Check>\n  Please read the [LangSmith architectural overview](/langsmith/self-hosted) and [guide on connecting to external ClickHouse](/langsmith/self-host-external-clickhouse) before proceeding with this guide.\n</Check>\n\nLangSmith uses ClickHouse as the primary storage engine for **traces** and **feedback**. For easier management and scaling, it is recommended to connect a self-hosted LangSmith instance to an external ClickHouse instance. LangSmith-managed ClickHouse is an option that allows you to use a fully managed ClickHouse instance that is monitored and maintained by the LangSmith team.\n\n## Architecture Overview\n\nThe architecture of using LangSmith-managed ClickHouse with your self-hosted LangSmith instance is similar to using a fully self-hosted ClickHouse instance, with a few key differences:\n\n* You will need to set up a private network connection between your LangSmith instance and the LangSmith-managed ClickHouse instance. This is to ensure that your data is secure and that you can connect to the ClickHouse instance from your self-hosted LangSmith instance.\n* With this option, sensitive information (inputs and outputs) of your traces will be stored in cloud object storage (S3 or GCS) within your cloud instead of ClickHouse to ensure that sensitive information doesn't leave your VPC. For more details on where particular data fields are stored, refer to [Data storage](#data-storage).\n* The LangSmith team will monitor your ClickHouse instance and ensure that it is running smoothly. This allows us to track metrics like run-ingestion delay and query performance.\n\nThe overall architecture looks like this:\n\n<img className=\"block dark:hidden\" src=\"https://mintcdn.com/langchain-5e9cc07a/JOyLr_spVEW0t2KF/langsmith/images/managed-clickhouse-light.png?fit=max&auto=format&n=JOyLr_spVEW0t2KF&q=85&s=26fae5c3f413c15302ea0c00bebf8e93\" alt=\"LangSmith managed ClickHouse architecture.\" data-og-width=\"2196\" width=\"2196\" data-og-height=\"1755\" height=\"1755\" data-path=\"langsmith/images/managed-clickhouse-light.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/langchain-5e9cc07a/JOyLr_spVEW0t2KF/langsmith/images/managed-clickhouse-light.png?w=280&fit=max&auto=format&n=JOyLr_spVEW0t2KF&q=85&s=b9cb43d51325b0d9858123066c0f8812 280w, https://mintcdn.com/langchain-5e9cc07a/JOyLr_spVEW0t2KF/langsmith/images/managed-clickhouse-light.png?w=560&fit=max&auto=format&n=JOyLr_spVEW0t2KF&q=85&s=f21865c150f4047d9cfd0eee690099af 560w, https://mintcdn.com/langchain-5e9cc07a/JOyLr_spVEW0t2KF/langsmith/images/managed-clickhouse-light.png?w=840&fit=max&auto=format&n=JOyLr_spVEW0t2KF&q=85&s=3df50b05e66bc3092558e23e321d11fe 840w, https://mintcdn.com/langchain-5e9cc07a/JOyLr_spVEW0t2KF/langsmith/images/managed-clickhouse-light.png?w=1100&fit=max&auto=format&n=JOyLr_spVEW0t2KF&q=85&s=821f427c87e452c5d93aec971de3e5c3 1100w, https://mintcdn.com/langchain-5e9cc07a/JOyLr_spVEW0t2KF/langsmith/images/managed-clickhouse-light.png?w=1650&fit=max&auto=format&n=JOyLr_spVEW0t2KF&q=85&s=ffd26e217759a683feeacdacde65c047 1650w, https://mintcdn.com/langchain-5e9cc07a/JOyLr_spVEW0t2KF/langsmith/images/managed-clickhouse-light.png?w=2500&fit=max&auto=format&n=JOyLr_spVEW0t2KF&q=85&s=75b39fb829a3ed7491f3550ad5323965 2500w\" />\n\n<img className=\"hidden dark:block\" src=\"https://mintcdn.com/langchain-5e9cc07a/JOyLr_spVEW0t2KF/langsmith/images/managed-clickhouse-dark.png?fit=max&auto=format&n=JOyLr_spVEW0t2KF&q=85&s=a3062f45f9c01f05e6917bca3f34735e\" alt=\"LangSmith managed ClickHouse architecture.\" data-og-width=\"2196\" width=\"2196\" data-og-height=\"1755\" height=\"1755\" data-path=\"langsmith/images/managed-clickhouse-dark.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/langchain-5e9cc07a/JOyLr_spVEW0t2KF/langsmith/images/managed-clickhouse-dark.png?w=280&fit=max&auto=format&n=JOyLr_spVEW0t2KF&q=85&s=c2a591803a03df470900d351a3ba59dc 280w, https://mintcdn.com/langchain-5e9cc07a/JOyLr_spVEW0t2KF/langsmith/images/managed-clickhouse-dark.png?w=560&fit=max&auto=format&n=JOyLr_spVEW0t2KF&q=85&s=80f1fd346d92de102121180ac7995e0f 560w, https://mintcdn.com/langchain-5e9cc07a/JOyLr_spVEW0t2KF/langsmith/images/managed-clickhouse-dark.png?w=840&fit=max&auto=format&n=JOyLr_spVEW0t2KF&q=85&s=6bb18f947823c721cba47bc275999cc2 840w, https://mintcdn.com/langchain-5e9cc07a/JOyLr_spVEW0t2KF/langsmith/images/managed-clickhouse-dark.png?w=1100&fit=max&auto=format&n=JOyLr_spVEW0t2KF&q=85&s=0d7313f3682d35e743a82f44465b9af6 1100w, https://mintcdn.com/langchain-5e9cc07a/JOyLr_spVEW0t2KF/langsmith/images/managed-clickhouse-dark.png?w=1650&fit=max&auto=format&n=JOyLr_spVEW0t2KF&q=85&s=2f96d154dff0885379ce9d0b6a8e40e9 1650w, https://mintcdn.com/langchain-5e9cc07a/JOyLr_spVEW0t2KF/langsmith/images/managed-clickhouse-dark.png?w=2500&fit=max&auto=format&n=JOyLr_spVEW0t2KF&q=85&s=b750629ab6f6ce608695538ff3ad46f5 2500w\" />\n\n* **You must use a supported blob storage option.** Read the [blob storage guide](/langsmith/self-host-blob-storage) for more information.\n* To use private endpoints, ensure that your VPC is in a ClickHouse Cloud supported [region](https://clickhouse.com/docs/en/cloud/reference/supported-regions). Otherwise, you will need to use a public endpoint we will secure with firewall rules. Your VPC will need to have a NAT gateway to allow us to allowlist your traffic.\n* You must have a VPC that can connect to the LangSmith-managed ClickHouse service. You will need to work with our team to set up the necessary networking.\n* You must have a LangSmith self-hosted instance running. You can use our managed ClickHouse service with both [Kubernetes](/langsmith/kubernetes) and [Docker](/langsmith/docker) installations.\n\nClickHouse stores **runs** and **feedback** data, specifically:\n\n* All feedback data fields.\n* Some run data fields.\n\nFor a list of fields, refer to [Stored run data fields](#stored-run-data-fields) and [Stored feedback data fields](#stored-feedback-data-fields).\n\nLangChain defines sensitive application data as `inputs`, `outputs`, `errors`, `manifests`, `extras`, and `events` of a run, since these fields may contain LLM prompts and completions. With LangSmith-managed ClickHouse, these sensitive fields are stored in cloud object storage (S3 or GCS) within your cloud, while the rest of the run data is stored in ClickHouse, ensuring sensitive information never leaves your VPC.\n\n### Stored feedback data fields\n\n<Note>\n  Because all feedback data is stored in ClickHouse, do not send sensitive information in feedback (scores and annotations/comments) or in any other run fields that are mentioned in [Stored run data fields](#stored-run-data-fields).\n</Note>\n\nUsing a LangSmith-managed ClickHouse setup, **all feedback data fields are stored in ClickHouse**:\n\n| Field Name                | Type     | Description                                                                                            |\n| ------------------------- | -------- | ------------------------------------------------------------------------------------------------------ |\n| id                        | UUID     | Unique identifier for the record itself                                                                |\n| created\\_at               | datetime | Timestamp when the record was created                                                                  |\n| modified\\_at              | datetime | Timestamp when the record was last modified                                                            |\n| session\\_id               | UUID     | Unique identifier for the experiment or tracing project the run was a part of                          |\n| run\\_id                   | UUID     | Unique identifier for a specific run within a session                                                  |\n| key                       | string   | A key describing the criteria of the feedback, eg \"correctness\"                                        |\n| score                     | number   | Numerical score associated with the feedback key                                                       |\n| value                     | string   | Reserved for storing a value associated with the score. Useful for categorical feedback.               |\n| comment                   | string   | Any comment or annotation associated with the record. This can be a justification for the score given. |\n| correction                | object   | Reserved for storing correction details, if any                                                        |\n| feedback\\_source          | object   | Object containing information about the feedback source                                                |\n| feedback\\_source.type     | string   | The type of source where the feedback originated, eg \"api\", \"app\", \"evaluator\"                         |\n| feedback\\_source.metadata | object   | Reserved for additional metadata, currently                                                            |\n| feedback\\_source.user\\_id | UUID     | Unique identifier for the user providing feedback                                                      |\n\nThis [reference doc](/langsmith/feedback-data-format) explains the stored feedback format, which is the LangSmith's way of representing evaluation scores and annotations on runs.\n\n### Stored run data fields\n\nRun data fields are split between the managed ClickHouse database and your cloud object storage (e.g., S3 or GCS).\n\n<Note>\n  For run fields stored in object storage, only a reference or pointer is kept in ClickHouse. For example, `inputs` and `outputs` content are offloaded to S3/GCS, with the ClickHouse record storing corresponding S3 URLs in the `inputs_s3_urls` and `outputs_s3_urls` fields.\n</Note>\n\nThe table details each run field and where it is stored:\n\n| Field                          | Storage Location   |\n| ------------------------------ | ------------------ |\n| `id`                           | ClickHouse         |\n| `name`                         | ClickHouse         |\n| `inputs`                       | **Object Storage** |\n| `run_type`                     | ClickHouse         |\n| `start_time`                   | ClickHouse         |\n| `end_time`                     | ClickHouse         |\n| `extra`                        | **Object Storage** |\n| `error`                        | **Object Storage** |\n| `outputs`                      | **Object Storage** |\n| `events`                       | **Object Storage** |\n| `tags`                         | ClickHouse         |\n| `trace_id`                     | ClickHouse         |\n| `dotted_order`                 | ClickHouse         |\n| `status`                       | ClickHouse         |\n| `child_run_ids`                | ClickHouse         |\n| `direct_child_run_ids`         | ClickHouse         |\n| `parent_run_ids`               | ClickHouse         |\n| `feedback_stats`               | ClickHouse         |\n| `reference_example_id`         | ClickHouse         |\n| `total_tokens`                 | ClickHouse         |\n| `prompt_tokens`                | ClickHouse         |\n| `completion_tokens`            | ClickHouse         |\n| `total_cost`                   | ClickHouse         |\n| `prompt_cost`                  | ClickHouse         |\n| `completion_cost`              | ClickHouse         |\n| `first_token_time`             | ClickHouse         |\n| `session_id`                   | ClickHouse         |\n| `in_dataset`                   | ClickHouse         |\n| `parent_run_id`                | ClickHouse         |\n| `execution_order` (deprecated) | ClickHouse         |\n| `serialized`                   | ClickHouse         |\n| `manifest_id` (deprecated)     | ClickHouse         |\n| `manifest_s3_id`               | ClickHouse         |\n| `inputs_s3_urls`               | ClickHouse         |\n| `outputs_s3_urls`              | ClickHouse         |\n| `price_model_id`               | ClickHouse         |\n| `app_path`                     | ClickHouse         |\n| `last_queued_at`               | ClickHouse         |\n| `share_token`                  | ClickHouse         |\n\nThis [reference doc](/langsmith/run-data-format) explains the format of stored runs (spans), which are the building blocks of traces.\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/langsmith/langsmith-managed-clickhouse.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>",
  "code_samples": [],
  "headings": [
    {
      "level": "h2",
      "text": "Architecture Overview",
      "id": "architecture-overview"
    },
    {
      "level": "h2",
      "text": "Requirements",
      "id": "requirements"
    },
    {
      "level": "h2",
      "text": "Data storage",
      "id": "data-storage"
    },
    {
      "level": "h3",
      "text": "Stored feedback data fields",
      "id": "stored-feedback-data-fields"
    },
    {
      "level": "h3",
      "text": "Stored run data fields",
      "id": "stored-run-data-fields"
    }
  ],
  "url": "llms-txt#langsmith-managed-clickhouse",
  "links": []
}