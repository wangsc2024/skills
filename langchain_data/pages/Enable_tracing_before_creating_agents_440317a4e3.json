{
  "title": "Enable tracing before creating agents",
  "content": "setup_langsmith()\npython  theme={null}\nclass Assistant(Agent):\n    def __init__(self) -> None:\n        super().__init__(\n            instructions=\"\"\"You are a helpful voice AI assistant.\n            You eagerly assist users with their questions.\n            Keep responses concise and conversational.\"\"\",\n        )\npython  theme={null}\nserver = AgentServer()\n\n@server.rtc_session()\nasync def my_agent(ctx: agents.JobContext):\n    # Create agent session with STT, LLM, TTS, and VAD\n    session = AgentSession(\n        stt=\"deepgram/nova-2:en\",\n        llm=\"openai/gpt-4o-mini\",\n        tts=openai.TTS(model=\"tts-1\", voice=\"alloy\"),\n        vad=silero.VAD.load(),\n        turn_detection=MultilingualModel(),\n    )\n\n# Start the session\n    await session.start(\n        room=ctx.room,\n        agent=Assistant(),\n    )\n\nif __name__ == \"__main__\":\n    # Run in console mode for local testing\n    sys.argv = [sys.argv[0], \"console\"]\n    agents.cli.run_app(server)\nbash  theme={null}\npython agent.py console\npython  theme={null}\nfrom opentelemetry import trace\n\nclass Assistant(Agent):\n    def __init__(self) -> None:\n        super().__init__(\n            instructions=\"You are a helpful assistant.\",\n        )\n\n# Get current span and add custom attributes\n        tracer = trace.get_tracer(__name__)\n        span = trace.get_current_span()\n        if span:\n            span.set_attribute(\"langsmith.metadata.agent_type\", \"voice_assistant\")\n            span.set_attribute(\"langsmith.metadata.version\", \"1.0\")\n            span.set_attribute(\"langsmith.span.tags\", \"livekit,voice-ai,production\")\n```\n\n### Spans not appearing in LangSmith\n\nIf traces aren't showing up in LangSmith:\n\n1. **Verify environment variables**: Ensure `OTEL_EXPORTER_OTLP_ENDPOINT` and `OTEL_EXPORTER_OTLP_HEADERS` are set correctly in your `.env` file.\n2. **Check setup order**: Make sure `setup_langsmith()` is called **before** creating `AgentServer`.\n3. **Check API key**: Confirm your LangSmith API key has write permissions.\n4. **Look for confirmation**: You should see \"âœ… LangSmith tracing enabled\" in the console when starting.\n\n### Messages not showing correctly\n\nIf conversation messages aren't displaying properly:\n\n1. **Check span processor**: Verify `langsmith_processor.py` is in your project directory and imported correctly.\n2. **Verify imports**: Ensure `LangSmithSpanProcessor` is imported in your agent.py.\n3. **Enable debug logging**: Set `LANGSMITH_PROCESSOR_DEBUG=true` in your environment to see detailed logs.\n\n### Connection issues\n\nIf your agent can't connect to LiveKit:\n\n1. **Verify LiveKit URL**: Check `LIVEKIT_URL` is set correctly in your `.env` file.\n2. **Check credentials**: Ensure `LIVEKIT_API_KEY` and `LIVEKIT_API_SECRET` are correct.\n3. **Test connection**: Try connecting to your LiveKit server with the LiveKit CLI first.\n4. **Console mode**: For local testing, always use: `python agent.py console`.\n\nIf you're getting import errors:\n\n1. **Install dependencies**: Run the complete pip install command from Step 1.\n2. **Check Python version**: Ensure you're using Python 3.9 or higher.\n3. **Verify langsmith\\_processor**: Make sure `langsmith_processor.py` is downloaded and in the same directory as `agent.py`.\n4. **Check LiveKit plugins**: Ensure you have the correct LiveKit plugins installed for your STT/LLM/TTS providers.\n\n### Agent not responding\n\nIf your agent connects but doesn't respond:\n\n1. **Check API keys**: Verify your OpenAI API key (or other provider keys) are correct.\n2. **Test services**: Ensure your STT, LLM, and TTS services are accessible.\n3. **Check instructions**: Make sure your Agent has proper instructions.\n4. **Review logs**: Look for errors in the console output.\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/langsmith/trace-with-livekit.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>",
  "code_samples": [
    {
      "code": "#### Part 2: Define your agent",
      "language": "unknown"
    },
    {
      "code": "#### Part 3: Set up the agent server",
      "language": "unknown"
    },
    {
      "code": "### Step 4: Run your agent\n\nRun your voice agent in console mode for local testing:",
      "language": "unknown"
    },
    {
      "code": "Your agent will start and connect to LiveKit. Speak through your microphone, and all traces will automatically appear in LangSmith. Here is an example of a trace in LangSmith: [LangSmith trace with LiveKit](https://smith.langchain.com/public/0f583c03-6d2a-4a2c-a043-9588e387cb55/r)\n\nView the complete [agent.py code](https://github.com/langchain-ai/voice-agents-tracing/blob/main/livekit/agent.py).\n\n## Advanced usage\n\n### Custom metadata and tags\n\nYou can add custom metadata to your traces using span attributes:",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h3",
      "text": "Step 4: Run your agent",
      "id": "step-4:-run-your-agent"
    },
    {
      "level": "h2",
      "text": "Advanced usage",
      "id": "advanced-usage"
    },
    {
      "level": "h3",
      "text": "Custom metadata and tags",
      "id": "custom-metadata-and-tags"
    },
    {
      "level": "h2",
      "text": "Troubleshooting",
      "id": "troubleshooting"
    },
    {
      "level": "h3",
      "text": "Spans not appearing in LangSmith",
      "id": "spans-not-appearing-in-langsmith"
    },
    {
      "level": "h3",
      "text": "Messages not showing correctly",
      "id": "messages-not-showing-correctly"
    },
    {
      "level": "h3",
      "text": "Connection issues",
      "id": "connection-issues"
    },
    {
      "level": "h3",
      "text": "Import errors",
      "id": "import-errors"
    },
    {
      "level": "h3",
      "text": "Agent not responding",
      "id": "agent-not-responding"
    }
  ],
  "url": "llms-txt#enable-tracing-before-creating-agents",
  "links": []
}