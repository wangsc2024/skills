{
  "title": "Keep our previous handlers...",
  "content": "from langgraph_sdk import Auth\n\n@auth.on.threads.create\nasync def on_thread_create(\n    ctx: Auth.types.AuthContext,\n    value: Auth.types.on.threads.create.value,\n):\n    \"\"\"Add owner when creating threads.\n\nThis handler runs when creating new threads and does two things:\n    1. Sets metadata on the thread being created to track ownership\n    2. Returns a filter that ensures only the creator can access it\n    \"\"\"\n    # Example value:\n    #  {'thread_id': UUID('99b045bc-b90b-41a8-b882-dabc541cf740'), 'metadata': {}, 'if_exists': 'raise'}\n\n# Add owner metadata to the thread being created\n    # This metadata is stored with the thread and persists\n    metadata = value.setdefault(\"metadata\", {})\n    metadata[\"owner\"] = ctx.user.identity\n\n# Return filter to restrict access to just the creator\n    return {\"owner\": ctx.user.identity}\n\n@auth.on.threads.read\nasync def on_thread_read(\n    ctx: Auth.types.AuthContext,\n    value: Auth.types.on.threads.read.value,\n):\n    \"\"\"Only let users read their own threads.\n\nThis handler runs on read operations. We don't need to set\n    metadata since the thread already exists - we just need to\n    return a filter to ensure users can only see their own threads.\n    \"\"\"\n    return {\"owner\": ctx.user.identity}\n\n@auth.on.assistants\nasync def on_assistants(\n    ctx: Auth.types.AuthContext,\n    value: Auth.types.on.assistants.value,\n):\n    # For illustration purposes, we will deny all requests\n    # that touch the assistants resource\n    # Example value:\n    # {\n    #     'assistant_id': UUID('63ba56c3-b074-4212-96e2-cc333bbc4eb4'),\n    #     'graph_id': 'agent',\n    #     'config': {},\n    #     'metadata': {},\n    #     'name': 'Untitled'\n    # }\n    raise Auth.exceptions.HTTPException(\n        status_code=403,\n        detail=\"User lacks the required permissions.\",\n    )",
  "code_samples": [],
  "headings": [],
  "url": "llms-txt#keep-our-previous-handlers...",
  "links": []
}