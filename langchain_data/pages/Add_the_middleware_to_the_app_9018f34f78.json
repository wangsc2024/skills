{
  "title": "Add the middleware to the app",
  "content": "app.add_middleware(CustomHeaderMiddleware)\njson  theme={null}\n{\n  \"dependencies\": [\".\"],\n  \"graphs\": {\n    \"agent\": \"./src/agent/graph.py:graph\"\n  },\n  \"env\": \".env\",\n  \"http\": {\n    \"app\": \"./src/agent/webapp.py:app\"\n  }\n  // Other configuration options like auth, store, etc.\n}\njson  theme={null}\n{\n  \"dependencies\": [\".\"],\n  \"graphs\": {\n    \"agent\": \"./src/agent/graph.py:graph\"\n  },\n  \"env\": \".env\",\n  \"http\": {\n    \"app\": \"./src/agent/webapp.py:app\",\n    \"middleware_order\": \"auth_first\"\n  },\n  \"auth\": {\n    \"path\": \"./auth.py:my_auth\"\n  }\n}\nbash  theme={null}\nlanggraph dev --no-browser\n```\n\nNow any request to your server will include the custom header `X-Custom-Header` in its response.\n\nYou can deploy this app as-is to cloud or to your self-hosted platform.\n\nNow that you've added custom middleware to your deployment, you can use similar techniques to add [custom routes](/langsmith/custom-routes) or define [custom lifespan events](/langsmith/custom-lifespan) to further customize your server's behavior.\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/langsmith/custom-middleware.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>",
  "code_samples": [
    {
      "code": "## Configure `langgraph.json`\n\nAdd the following to your `langgraph.json` configuration file. Make sure the path points to the `webapp.py` file you created above.",
      "language": "unknown"
    },
    {
      "code": "### Customize middleware ordering\n\nBy default, custom middleware runs before authentication logic. To run custom middleware *after* authentication, set `middleware_order` to `auth_first` in your `http` configuration. (This customization is supported starting with API server v0.4.35 and later.)",
      "language": "unknown"
    },
    {
      "code": "## Start server\n\nTest the server out locally:",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "Configure `langgraph.json`",
      "id": "configure-`langgraph.json`"
    },
    {
      "level": "h3",
      "text": "Customize middleware ordering",
      "id": "customize-middleware-ordering"
    },
    {
      "level": "h2",
      "text": "Start server",
      "id": "start-server"
    },
    {
      "level": "h2",
      "text": "Deploying",
      "id": "deploying"
    },
    {
      "level": "h2",
      "text": "Next steps",
      "id": "next-steps"
    }
  ],
  "url": "llms-txt#add-the-middleware-to-the-app",
  "links": []
}