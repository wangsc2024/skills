{
  "title": "Connect an authentication provider",
  "content": "Source: https://docs.langchain.com/langsmith/add-auth-server\n\nIn [the last tutorial](/langsmith/resource-auth), you added resource authorization to give users private conversations. However, you are still using hard-coded tokens for authentication, which is not secure. Now you'll replace those tokens with real user accounts using [OAuth2](/langsmith/deployment-quickstart).\n\nYou'll keep the same [`Auth`](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.auth.Auth) object and [resource-level access control](/langsmith/auth#single-owner-resources), but upgrade authentication to use Supabase as your identity provider. While Supabase is used in this tutorial, the concepts apply to any OAuth2 provider. You'll learn how to:\n\n1. Replace test tokens with real JWT tokens\n2. Integrate with OAuth2 providers for secure user authentication\n3. Handle user sessions and metadata while maintaining our existing authorization logic\n\nOAuth2 involves three main roles:\n\n1. **Authorization server**: The identity provider (e.g., Supabase, Auth0, Google) that handles user authentication and issues tokens\n2. **Application backend**: Your LangGraph application. This validates tokens and serves protected resources (conversation data)\n3. **Client application**: The web or mobile app where users interact with your service\n\nA standard OAuth2 flow works something like this:\n\nBefore you start this tutorial, ensure you have:\n\n* The [bot from the second tutorial](/langsmith/resource-auth) running without errors.\n* A [Supabase project](https://supabase.com/dashboard) to use its authentication server.\n\n## 1. Install dependencies\n\nInstall the required dependencies. Start in your `custom-auth` directory and ensure you have the `langgraph-cli` installed:\n\n<a id=\"setup-auth-provider\" />\n\n## 2. Set up the authentication provider\n\nNext, fetch the URL of your auth server and the private key for authentication.\nSince you're using Supabase for this, you can do this in the Supabase dashboard:\n\n1. In the left sidebar, click on t️⚙ Project Settings\" and then click \"API\"\n2. Copy your project URL and add it to your `.env` file\n\n3. Copy your service role secret key and add it to your `.env` file:\n\n4. Copy your \"anon public\" key and note it down. This will be used later when you set up our client code.\n\n## 3. Implement token validation\n\nIn the previous tutorials, you used the [`Auth`](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.auth.Auth) object to [validate hard-coded tokens](/langsmith/set-up-custom-auth) and [add resource ownership](/langsmith/resource-auth).\n\nNow you'll upgrade your authentication to validate real JWT tokens from Supabase. The main changes will all be in the [`@auth.authenticate`](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.auth.Auth.authenticate) decorated function:\n\n* Instead of checking against a hard-coded list of tokens, you'll make an HTTP request to Supabase to validate the token.\n* You'll extract real user information (ID, email) from the validated token.\n* The existing resource authorization logic remains unchanged.\n\nUpdate `src/security/auth.py` to implement this:\n\n```python {highlight={8-9,20-30}} title=\"src/security/auth.py\" theme={null}\nimport os\nimport httpx\nfrom langgraph_sdk import Auth",
  "code_samples": [
    {
      "code": "## Prerequisites\n\nBefore you start this tutorial, ensure you have:\n\n* The [bot from the second tutorial](/langsmith/resource-auth) running without errors.\n* A [Supabase project](https://supabase.com/dashboard) to use its authentication server.\n\n## 1. Install dependencies\n\nInstall the required dependencies. Start in your `custom-auth` directory and ensure you have the `langgraph-cli` installed:\n\n<CodeGroup>",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "</CodeGroup>\n\n<a id=\"setup-auth-provider\" />\n\n## 2. Set up the authentication provider\n\nNext, fetch the URL of your auth server and the private key for authentication.\nSince you're using Supabase for this, you can do this in the Supabase dashboard:\n\n1. In the left sidebar, click on t️⚙ Project Settings\" and then click \"API\"\n2. Copy your project URL and add it to your `.env` file",
      "language": "unknown"
    },
    {
      "code": "3. Copy your service role secret key and add it to your `.env` file:",
      "language": "unknown"
    },
    {
      "code": "4. Copy your \"anon public\" key and note it down. This will be used later when you set up our client code.",
      "language": "unknown"
    },
    {
      "code": "## 3. Implement token validation\n\nIn the previous tutorials, you used the [`Auth`](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.auth.Auth) object to [validate hard-coded tokens](/langsmith/set-up-custom-auth) and [add resource ownership](/langsmith/resource-auth).\n\nNow you'll upgrade your authentication to validate real JWT tokens from Supabase. The main changes will all be in the [`@auth.authenticate`](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.auth.Auth.authenticate) decorated function:\n\n* Instead of checking against a hard-coded list of tokens, you'll make an HTTP request to Supabase to validate the token.\n* You'll extract real user information (ID, email) from the validated token.\n* The existing resource authorization logic remains unchanged.\n\nUpdate `src/security/auth.py` to implement this:",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "Background",
      "id": "background"
    },
    {
      "level": "h2",
      "text": "Prerequisites",
      "id": "prerequisites"
    },
    {
      "level": "h2",
      "text": "1. Install dependencies",
      "id": "1.-install-dependencies"
    },
    {
      "level": "h2",
      "text": "2. Set up the authentication provider",
      "id": "2.-set-up-the-authentication-provider"
    },
    {
      "level": "h2",
      "text": "3. Implement token validation",
      "id": "3.-implement-token-validation"
    }
  ],
  "url": "llms-txt#connect-an-authentication-provider",
  "links": []
}