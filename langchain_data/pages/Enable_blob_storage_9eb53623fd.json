{
  "title": "Enable blob storage",
  "content": "Source: https://docs.langchain.com/langsmith/self-host-blob-storage\n\nBy default, LangSmith stores run inputs, outputs, errors, manifests, extras, and events in ClickHouse. If you so choose, you can instead store this information in blob storage, which has a couple of notable benefits. For the best results in production deployments, we **strongly** recommend using blob storage, which offers the following benefits:\n\n1. In high trace environments, inputs, outputs, errors, manifests, extras, and events may balloon the size of your databases.\n2. If using LangSmith Managed ClickHouse, you may want sensitive information in blob storage that resides in your environment. To alleviate this, LangSmith supports storing run inputs, outputs, errors, manifests, extras, events, and attachments in an external blob storage system.\n\n<Note>\n  Azure blob storage is available in Helm chart versions 0.8.9 and greater. [Deleting trace projects](/langsmith/observability-concepts#deleting-traces-from-langsmith) is supported in Azure starting in Helm chart version 0.10.43.\n</Note>\n\n* Access to a valid blob storage service\n\n* [Amazon S3](https://aws.amazon.com/s3/)\n    * [Google Cloud Storage (GCS)](https://cloud.google.com/storage?hl=en)\n  * [Azure Blob Storage](https://azure.microsoft.com/en-us/products/storage/blobs)\n\n* A bucket/directory in your blob storage to store the data. We highly recommend creating a separate bucket/directory for LangSmith data.\n  * **If you are using TTLs**, you will need to set up a lifecycle policy to delete old data. You can find more information on configuring TTLs [here](/langsmith/self-host-ttl). These policies should mirror the TTLs you have set in your LangSmith configuration, or you may experience data loss. See [here](#ttl-configuration) on how to setup the lifecycle rules for TTLs for blob storage.\n\n* Credentials to permit LangSmith Services to access the bucket/directory\n  * You will need to provide your LangSmith instance with the necessary credentials to access the bucket/directory. Read the authentication [section](#authentication) below for more information.\n\n* If using S3 or GCS, an API url for your blob storage service\n\n* This will be the URL that LangSmith uses to access your blob storage system\n  * For Amazon S3, this will be the URL of the S3 endpoint. Something like: `https://s3.amazonaws.com` or `https://s3.us-west-1.amazonaws.com` if using a regional endpoint.\n  * For Google Cloud Storage, this will be the URL of the GCS endpoint. Something like: `https://storage.googleapis.com`\n\nTo authenticate to [Amazon S3](https://aws.amazon.com/s3/), you will need to create an IAM policy granting the following permissions on your bucket.\n\nOnce you have the correct policy, there are three ways to authenticate with Amazon S3:\n\n1. [**(Recommended) IAM Role for Service Account**](https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html): You can create an IAM role for your LangSmith instance and attach the policy to that role. You can then provide the role to LangSmith. This is the recommended way to authenticate with Amazon S3 in production.\n\n1. You will need to create an IAM role with the policy attached.\n   2. You will need to allow LangSmith service accounts to assume the role. The `langsmith-queue`, `langsmith-backend`, and `langsmith-platform-backend` service accounts will need to be able to assume the role.\n      <Warning>\n        The service account names will be different if you are using a custom release name. You can find the service account names by running `kubectl get serviceaccounts` in your cluster.\n      </Warning>\n   3. You will need to provide the role ARN to LangSmith. You can do this by adding the `eks.amazonaws.com/role-arn: \"<role_arn>\"` annotation to the `queue`, `backend`, and `platform-backend` services in your Helm Chart installation.\n\n2. [**Access Key and Secret Key**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html): You can provide LangSmith with an access key and secret key. This is the simplest way to authenticate with Amazon S3. However, it is not recommended for production use as it is less secure.\n   1. You will need to create a user with the policy attached. Then you can provision an access key and secret key for that user.\n\n3. [**VPC Endpoint Access**](https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints-s3.html): You can enable access to your S3 bucket via a VPC endpoint, which allows traffic to flow securely from your VPC to your S3 bucket.\n\n1. You'll need to provision a VPC endpoint and configure it to allow access to your S3 bucket.\n   2. You can refer to our [public Terraform modules](https://github.com/langchain-ai/terraform/blob/main/modules/aws/s3/main.tf#L12) for guidance and an example of configuring this.\n\n#### KMS encryption header support for S3\n\nStarting with LangSmith Helm chart version **0.11.24**, you can pass a KMS encryption key header and enforce a specific KMS key for writes by providing its ARN. To enable this, set the following values in your Helm chart:\n\n### Google Cloud Storage\n\nTo authenticate with [Google Cloud Storage](https://cloud.google.com/storage?hl=en), you will need to create a [`service account`](https://cloud.google.com/iam/docs/service-account-overview) with the necessary permissions to access your bucket.\n\nYour service account will need the `Storage Admin` role or a custom role with equivalent permissions. This can be scoped to the bucket that LangSmith will be using.\n\nOnce you have a provisioned service account, you will need to generate a [`HMAC key`](https://cloud.google.com/storage/docs/authentication/hmackeys) for that service account. This key and secret will be used to authenticate with Google Cloud Storage.\n\n### Azure Blob Storage\n\nTo authenticate with [Azure Blob Storage](https://azure.microsoft.com/en-us/products/storage/blobs), you will need to use one of the following methods to grant LangSmith workloads permission to access your [container](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction#containers) (listed in order of precedence):\n\n1. [Storage account and access key](https://learn.microsoft.com/en-us/azure/storage/common/storage-account-keys-manage)\n2. [Connection string](https://learn.microsoft.com/en-us/azure/storage/common/storage-configure-connection-string)\n3. [Workload identity](https://azure.github.io/azure-workload-identity/docs/introduction.html) (recommended), managed identity, or environment variables supported by [`DefaultAzureCredential`](https://learn.microsoft.com/en-us/azure/developer/go/azure-sdk-authentication?tabs=bash#2-authenticate-with-azure). This is the default authentication method when configuration for either option above is not present.\n   1. To use workload identity, add the label `azure.workload.identity/use: true` to the `queue`, `backend`, and `platform-backend` deployments. Additionally, add the `azure.workload.identity/client-id` annotation to the corresponding service accounts, which should be an existing Azure AD Application's client ID or user-assigned managed identity's client ID. See [Azure's documentation](https://azure.github.io/azure-workload-identity/docs/topics/service-account-labels-and-annotations.html) for additional details.\n\n<Note>\n  Some deployments may need further customization of the connection configuration using a Service URL Override instead of the default service URL (`https://<storage_account_name>.blob.core.windows.net/`). For example, this override is necessary in order to use a different blob storage domain (e.g. government or china).\n</Note>\n\nBy default, LangSmith will still store tokens for search in ClickHouse. If you are using LangSmith Managed Clickhouse, you may want to disable this feature to avoid sending potentially sensitive information to ClickHouse. You can do this in your blob storage configuration.\n\nAfter creating your bucket and obtaining the necessary credentials, you can configure LangSmith to use your blob storage system.\n\n<Note>\n  Google Cloud Storage (GCS) exposes an S3-compatible API. When using GCS, set the blob storage engine to \"S3\", configure the <code>apiURL</code> to your GCS endpoint (for example, <code>[https://storage.googleapis.com](https://storage.googleapis.com)</code>), and authenticate using a service account HMAC access key and secret (using `accessKey` and `accessKeySecret`).\n\nYou must use **HMAC** access key and secret for GCS. We do not support service account annotations.\n</Note>\n\n<Note>\n  If using an access key and secret, you can also provide an existing Kubernetes secret that contains the authentication information. This is recommended over providing the access key and secret key directly in your config. See the [generated secret template](https://github.com/langchain-ai/helm/blob/main/charts/langsmith/templates/secrets.yaml) for the expected secret keys.\n</Note>\n\nIf using the [TTL](/langsmith/self-host-ttl) feature with LangSmith, you'll also have to configure TTL rules for your blob storage. Trace information stored on blob storage is stored on a particular prefix path, which determines the TTL for the data. When a trace's retention is extended, its corresponding blob storage path changes to ensure that it matches the new extended retention.\n\nThe following TTL prefix are used:\n\n* `ttl_s/`: Short term TTL, configured for 14 days.\n* `ttl_l/`: Long term TTL, configured for 400 days.\n\nIf you have customized the TTLs in your LangSmith configuration, you will need to adjust the TTLs in your blob storage configuration to match.\n\nIf using S3 for your blob storage, you will need to setup a filter lifecycle configuration that matches the prefixes above. You can find information for this [in the Amazon Documentation](https://docs.aws.amazon.com/AmazonS3/latest/userguide/intro-lifecycle-rules.html#intro-lifecycle-rules-filter).\n\nAs an example, if you are using Terraform to manage your S3 bucket, you would setup something like this:\n\n### Google Cloud Storage\n\nYou will need to setup lifecycle conditions for your GCS buckets that you are using. You can find information for this [in the Google Documentation](https://cloud.google.com/storage/docs/lifecycle#conditions), specifically using matchesPrefix.\n\nAs an example, if you are using Terraform to manage your GCS bucket, you would setup something like this:\n\n### Azure blob storage\n\nYou will need to configure a [lifecycle management policy](https://learn.microsoft.com/en-us/azure/storage/blobs/lifecycle-management-policy-configure) on the container in order to expire objects matching the prefixes above.\n\nAs an example, if you are [using Terraform to manage your blob storage container](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_management_policy), you would setup something like this:\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/langsmith/self-host-blob-storage.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>",
  "code_samples": [
    {
      "code": "Once you have the correct policy, there are three ways to authenticate with Amazon S3:\n\n1. [**(Recommended) IAM Role for Service Account**](https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html): You can create an IAM role for your LangSmith instance and attach the policy to that role. You can then provide the role to LangSmith. This is the recommended way to authenticate with Amazon S3 in production.\n\n   1. You will need to create an IAM role with the policy attached.\n   2. You will need to allow LangSmith service accounts to assume the role. The `langsmith-queue`, `langsmith-backend`, and `langsmith-platform-backend` service accounts will need to be able to assume the role.\n      <Warning>\n        The service account names will be different if you are using a custom release name. You can find the service account names by running `kubectl get serviceaccounts` in your cluster.\n      </Warning>\n   3. You will need to provide the role ARN to LangSmith. You can do this by adding the `eks.amazonaws.com/role-arn: \"<role_arn>\"` annotation to the `queue`, `backend`, and `platform-backend` services in your Helm Chart installation.\n\n2. [**Access Key and Secret Key**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html): You can provide LangSmith with an access key and secret key. This is the simplest way to authenticate with Amazon S3. However, it is not recommended for production use as it is less secure.\n   1. You will need to create a user with the policy attached. Then you can provision an access key and secret key for that user.\n\n3. [**VPC Endpoint Access**](https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints-s3.html): You can enable access to your S3 bucket via a VPC endpoint, which allows traffic to flow securely from your VPC to your S3 bucket.\n\n   1. You'll need to provision a VPC endpoint and configure it to allow access to your S3 bucket.\n   2. You can refer to our [public Terraform modules](https://github.com/langchain-ai/terraform/blob/main/modules/aws/s3/main.tf#L12) for guidance and an example of configuring this.\n\n#### KMS encryption header support for S3\n\nStarting with LangSmith Helm chart version **0.11.24**, you can pass a KMS encryption key header and enforce a specific KMS key for writes by providing its ARN. To enable this, set the following values in your Helm chart:",
      "language": "unknown"
    },
    {
      "code": "### Google Cloud Storage\n\nTo authenticate with [Google Cloud Storage](https://cloud.google.com/storage?hl=en), you will need to create a [`service account`](https://cloud.google.com/iam/docs/service-account-overview) with the necessary permissions to access your bucket.\n\nYour service account will need the `Storage Admin` role or a custom role with equivalent permissions. This can be scoped to the bucket that LangSmith will be using.\n\nOnce you have a provisioned service account, you will need to generate a [`HMAC key`](https://cloud.google.com/storage/docs/authentication/hmackeys) for that service account. This key and secret will be used to authenticate with Google Cloud Storage.\n\n### Azure Blob Storage\n\nTo authenticate with [Azure Blob Storage](https://azure.microsoft.com/en-us/products/storage/blobs), you will need to use one of the following methods to grant LangSmith workloads permission to access your [container](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction#containers) (listed in order of precedence):\n\n1. [Storage account and access key](https://learn.microsoft.com/en-us/azure/storage/common/storage-account-keys-manage)\n2. [Connection string](https://learn.microsoft.com/en-us/azure/storage/common/storage-configure-connection-string)\n3. [Workload identity](https://azure.github.io/azure-workload-identity/docs/introduction.html) (recommended), managed identity, or environment variables supported by [`DefaultAzureCredential`](https://learn.microsoft.com/en-us/azure/developer/go/azure-sdk-authentication?tabs=bash#2-authenticate-with-azure). This is the default authentication method when configuration for either option above is not present.\n   1. To use workload identity, add the label `azure.workload.identity/use: true` to the `queue`, `backend`, and `platform-backend` deployments. Additionally, add the `azure.workload.identity/client-id` annotation to the corresponding service accounts, which should be an existing Azure AD Application's client ID or user-assigned managed identity's client ID. See [Azure's documentation](https://azure.github.io/azure-workload-identity/docs/topics/service-account-labels-and-annotations.html) for additional details.\n\n<Note>\n  Some deployments may need further customization of the connection configuration using a Service URL Override instead of the default service URL (`https://<storage_account_name>.blob.core.windows.net/`). For example, this override is necessary in order to use a different blob storage domain (e.g. government or china).\n</Note>\n\n## CH Search\n\nBy default, LangSmith will still store tokens for search in ClickHouse. If you are using LangSmith Managed Clickhouse, you may want to disable this feature to avoid sending potentially sensitive information to ClickHouse. You can do this in your blob storage configuration.\n\n## Configuration\n\nAfter creating your bucket and obtaining the necessary credentials, you can configure LangSmith to use your blob storage system.\n\n<Note>\n  Google Cloud Storage (GCS) exposes an S3-compatible API. When using GCS, set the blob storage engine to \"S3\", configure the <code>apiURL</code> to your GCS endpoint (for example, <code>[https://storage.googleapis.com](https://storage.googleapis.com)</code>), and authenticate using a service account HMAC access key and secret (using `accessKey` and `accessKeySecret`).\n\n  You must use **HMAC** access key and secret for GCS. We do not support service account annotations.\n</Note>\n\n<CodeGroup>",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "</CodeGroup>\n\n<Note>\n  If using an access key and secret, you can also provide an existing Kubernetes secret that contains the authentication information. This is recommended over providing the access key and secret key directly in your config. See the [generated secret template](https://github.com/langchain-ai/helm/blob/main/charts/langsmith/templates/secrets.yaml) for the expected secret keys.\n</Note>\n\n## TTL Configuration\n\nIf using the [TTL](/langsmith/self-host-ttl) feature with LangSmith, you'll also have to configure TTL rules for your blob storage. Trace information stored on blob storage is stored on a particular prefix path, which determines the TTL for the data. When a trace's retention is extended, its corresponding blob storage path changes to ensure that it matches the new extended retention.\n\nThe following TTL prefix are used:\n\n* `ttl_s/`: Short term TTL, configured for 14 days.\n* `ttl_l/`: Long term TTL, configured for 400 days.\n\nIf you have customized the TTLs in your LangSmith configuration, you will need to adjust the TTLs in your blob storage configuration to match.\n\n### Amazon S3\n\nIf using S3 for your blob storage, you will need to setup a filter lifecycle configuration that matches the prefixes above. You can find information for this [in the Amazon Documentation](https://docs.aws.amazon.com/AmazonS3/latest/userguide/intro-lifecycle-rules.html#intro-lifecycle-rules-filter).\n\nAs an example, if you are using Terraform to manage your S3 bucket, you would setup something like this:",
      "language": "unknown"
    },
    {
      "code": "### Google Cloud Storage\n\nYou will need to setup lifecycle conditions for your GCS buckets that you are using. You can find information for this [in the Google Documentation](https://cloud.google.com/storage/docs/lifecycle#conditions), specifically using matchesPrefix.\n\nAs an example, if you are using Terraform to manage your GCS bucket, you would setup something like this:",
      "language": "unknown"
    },
    {
      "code": "### Azure blob storage\n\nYou will need to configure a [lifecycle management policy](https://learn.microsoft.com/en-us/azure/storage/blobs/lifecycle-management-policy-configure) on the container in order to expire objects matching the prefixes above.\n\nAs an example, if you are [using Terraform to manage your blob storage container](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_management_policy), you would setup something like this:",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "Requirements",
      "id": "requirements"
    },
    {
      "level": "h2",
      "text": "Authentication",
      "id": "authentication"
    },
    {
      "level": "h3",
      "text": "Amazon S3",
      "id": "amazon-s3"
    },
    {
      "level": "h3",
      "text": "Google Cloud Storage",
      "id": "google-cloud-storage"
    },
    {
      "level": "h3",
      "text": "Azure Blob Storage",
      "id": "azure-blob-storage"
    },
    {
      "level": "h2",
      "text": "CH Search",
      "id": "ch-search"
    },
    {
      "level": "h2",
      "text": "Configuration",
      "id": "configuration"
    },
    {
      "level": "h2",
      "text": "TTL Configuration",
      "id": "ttl-configuration"
    },
    {
      "level": "h3",
      "text": "Amazon S3",
      "id": "amazon-s3"
    },
    {
      "level": "h3",
      "text": "Google Cloud Storage",
      "id": "google-cloud-storage"
    },
    {
      "level": "h3",
      "text": "Azure blob storage",
      "id": "azure-blob-storage"
    }
  ],
  "url": "llms-txt#enable-blob-storage",
  "links": []
}