{
  "title": "Connect to an external PostgreSQL database",
  "content": "Source: https://docs.langchain.com/langsmith/self-host-external-postgres\n\nLangSmith uses a PostgreSQL database as the primary data store for transactional workloads and operational data (almost everything besides runs). By default, LangSmith Self-Hosted will use an internal PostgreSQL database. However, you can configure LangSmith to use an external PostgreSQL database. By configuring an external PostgreSQL database, you can more easily manage backups, scaling, and other operational tasks for your database.\n\n* A provisioned PostgreSQL database that your LangSmith instance will have network access to. We recommend using a managed PostgreSQL service like:\n\n* [Amazon RDS](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_GettingStarted.CreatingConnecting.PostgreSQL.html)\n  * [Google Cloud SQL](https://cloud.google.com/curated-resources/cloud-sql#section-1)\n  * [Azure Database for PostgreSQL](https://azure.microsoft.com/en-us/products/postgresql#features)\n\n* Note: We only officially support PostgreSQL versions >= 14.\n\n* A user with admin access to the PostgreSQL database. This user will be used to create the necessary tables, indexes, and schemas.\n\n* This user will also need to have the ability to create extensions in the database. We use/will try to install the `btree_gin`, `btree_gist`, `pgcrypto`, `citext`, `ltree`, and `pg_trgm` extensions.\n\n* If using a schema other than public, ensure that you do not have any other schemas with the extensions enabled, or you must include that in your search path.\n\n* Support for pgbouncer and other connection poolers is community-based. Community members have reported that pgbouncer has worked with `pool_mode` = `session` and a suitable setting for `ignore_startup_parameters` (as of writing, `search_path` and `lock_timeout` need to be ignored). Care is needed to avoid polluting connection pools; some level of PostgreSQL expertise is advisable. LangChain Inc currently does not have roadmap plans for formal test coverage or commercial support of pgbouncer or amazon rds proxy or any other poolers, but the community is welcome to discuss and collaborate on support through GitHub issues.\n\n* By default, we recommend an instance with **at least 2 vCPUs and 8GB of memory**. However, the actual requirements will depend on your workload and the number of users you have. We recommend monitoring your PostgreSQL instance and scaling up as needed.\n\nYou will need to provide a connection string to your PostgreSQL database. This connection string should include the following information:\n\n* Host\n* Port\n* Database\n* Username\n* Password (Make sure to url encode this if there are any special characters)\n* URL params\n\nThis will take the form of:\n\nAn example connection string might look like:\n\nWithout url parameters, the connection string would look like:\n\nWith your connection string in hand, you can configure your LangSmith instance to use an external PostgreSQL database. You can do this by modifying the `values` file for your LangSmith Helm Chart installation or the `.env` file for your Docker installation.\n\nOnce configured, you should be able to reinstall your LangSmith instance. If everything is configured correctly, your LangSmith instance should now be using your external PostgreSQL database.\n\n## TLS with PostgreSQL\n\nUse this section to configure TLS for PostgreSQL connections. For mounting internal/public CAs so LangSmith trusts your PostgreSQL server certificate, see [Configure custom TLS certificates](/langsmith/self-host-custom-tls-certificates#mount-internal-cas-for-tls).\n\n### Server TLS (one-way)\n\nTo validate the PostgreSQL server certificate:\n\n* Provide a CA bundle using `config.customCa.secretName` and `config.customCa.secretKey`.\n* Use `sslmode=require` or `sslmode=verify-full`, as well as `sslrootcert=system` to your connection URL.\n\n<Warning>\n  Mount a custom CA only when your PostgreSQL server uses an internal or private CA. Publicly trusted CAs do not require this configuration.\n</Warning>\n\n### Mutual TLS with Client Auth (mTLS)\n\nAs of LangSmith helm chart version **0.12.29**, we support mTLS for PostgreSQL clients. For server-side authentication in mTLS, use the [Server TLS steps](#server-tls-one-way) (custom CA) in addition to the following client certificate configuration.\n\nIf your PostgreSQL server requires client certificate authentication:\n\n* Provide a Secret with your client certificate and key.\n* Reference it via `postgres.external.clientCert.secretName` and specify the keys with `certSecretKey` and `keySecretKey`.\n* Use `sslmode=verify-full` and `sslrootcert=system` in your connection URL.\n\n#### Pod security context for certificate volumes\n\nThe certificate volumes mounted for mTLS are protected by file access restrictions. To ensure all LangSmith pods can read the certificate files, you must set `fsGroup: 1000` in the pod security context.\n\nYou can configure this in one of two ways:\n\n**Option 1: Use `commonPodSecurityContext`**\n\nSet the `fsGroup` at the top level to apply it to all pods:\n\n**Option 2: Add to individual pod security contexts**\n\nIf you need more granular control, add the `fsGroup` to each pod's security context individually. See the [mTLS configuration example](https://github.com/langchain-ai/helm/blob/main/charts/langsmith/examples/mtls_config.yaml) for a complete reference.\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/langsmith/self-host-external-postgres.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>",
  "code_samples": [
    {
      "code": "username:password@host:port/database?<url_params>",
      "language": "unknown"
    },
    {
      "code": "myuser:mypassword@myhost:5432/mydatabase?sslmode=disable",
      "language": "unknown"
    },
    {
      "code": "myuser:mypassword@myhost:5432/mydatabase",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "</CodeGroup>\n\nOnce configured, you should be able to reinstall your LangSmith instance. If everything is configured correctly, your LangSmith instance should now be using your external PostgreSQL database.\n\n## TLS with PostgreSQL\n\nUse this section to configure TLS for PostgreSQL connections. For mounting internal/public CAs so LangSmith trusts your PostgreSQL server certificate, see [Configure custom TLS certificates](/langsmith/self-host-custom-tls-certificates#mount-internal-cas-for-tls).\n\n### Server TLS (one-way)\n\nTo validate the PostgreSQL server certificate:\n\n* Provide a CA bundle using `config.customCa.secretName` and `config.customCa.secretKey`.\n* Use `sslmode=require` or `sslmode=verify-full`, as well as `sslrootcert=system` to your connection URL.\n\n<Warning>\n  Mount a custom CA only when your PostgreSQL server uses an internal or private CA. Publicly trusted CAs do not require this configuration.\n</Warning>\n\n<CodeGroup>",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "</CodeGroup>\n\n### Mutual TLS with Client Auth (mTLS)\n\nAs of LangSmith helm chart version **0.12.29**, we support mTLS for PostgreSQL clients. For server-side authentication in mTLS, use the [Server TLS steps](#server-tls-one-way) (custom CA) in addition to the following client certificate configuration.\n\nIf your PostgreSQL server requires client certificate authentication:\n\n* Provide a Secret with your client certificate and key.\n* Reference it via `postgres.external.clientCert.secretName` and specify the keys with `certSecretKey` and `keySecretKey`.\n* Use `sslmode=verify-full` and `sslrootcert=system` in your connection URL.\n\n<CodeGroup>",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "</CodeGroup>\n\n#### Pod security context for certificate volumes\n\nThe certificate volumes mounted for mTLS are protected by file access restrictions. To ensure all LangSmith pods can read the certificate files, you must set `fsGroup: 1000` in the pod security context.\n\nYou can configure this in one of two ways:\n\n**Option 1: Use `commonPodSecurityContext`**\n\nSet the `fsGroup` at the top level to apply it to all pods:",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "Requirements",
      "id": "requirements"
    },
    {
      "level": "h2",
      "text": "Connection String",
      "id": "connection-string"
    },
    {
      "level": "h2",
      "text": "Configuration",
      "id": "configuration"
    },
    {
      "level": "h2",
      "text": "TLS with PostgreSQL",
      "id": "tls-with-postgresql"
    },
    {
      "level": "h3",
      "text": "Server TLS (one-way)",
      "id": "server-tls-(one-way)"
    },
    {
      "level": "h3",
      "text": "Mutual TLS with Client Auth (mTLS)",
      "id": "mutual-tls-with-client-auth-(mtls)"
    }
  ],
  "url": "llms-txt#connect-to-an-external-postgresql-database",
  "links": []
}