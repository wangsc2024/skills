{
  "title": "required environment variables",
  "content": "CONTROL_PLANE_HOST = os.getenv(\"CONTROL_PLANE_HOST\")\nLANGSMITH_API_KEY = os.getenv(\"LANGSMITH_API_KEY\")\nWORKSPACE_ID = os.getenv(\"WORKSPACE_ID\")\nINTEGRATION_ID = os.getenv(\"INTEGRATION_ID\")\nMAX_WAIT_TIME = 1800  # 30 mins\n\ndef get_headers() -> dict:\n    \"\"\"Return common headers for requests to the control plane API.\"\"\"\n    return {\n        \"X-Api-Key\": LANGSMITH_API_KEY,\n        \"X-Tenant-Id\": WORKSPACE_ID,\n    }\n\ndef create_deployment() -> str:\n    \"\"\"Create deployment. Return deployment ID.\"\"\"\n    headers = get_headers()\n    headers[\"Content-Type\"] = \"application/json\"\n\ndeployment_name = \"my_deployment\"\n\nrequest_body = {\n        \"name\": deployment_name,\n        \"source\": \"github\",\n        \"source_config\": {\n            \"integration_id\": INTEGRATION_ID,\n            \"repo_url\": \"https://github.com/langchain-ai/langgraph-example\",\n            \"deployment_type\": \"dev\",\n            \"build_on_push\": False,\n            \"custom_url\": None,\n            \"resource_spec\": None,\n        },\n        \"source_revision_config\": {\n            \"repo_ref\": \"main\",\n            \"langgraph_config_path\": \"langgraph.json\",\n            \"image_uri\": None,\n        },\n        \"secrets\": [\n            {\n                \"name\": \"OPENAI_API_KEY\",\n                \"value\": \"test_openai_api_key\",\n            },\n            {\n                \"name\": \"ANTHROPIC_API_KEY\",\n                \"value\": \"test_anthropic_api_key\",\n            },\n            {\n                \"name\": \"TAVILY_API_KEY\",\n                \"value\": \"test_tavily_api_key\",\n            },\n        ],\n    }\n\nresponse = requests.post(\n        url=f\"{CONTROL_PLANE_HOST}/v2/deployments\",\n        headers=headers,\n        json=request_body,\n    )\n\nif response.status_code != 201:\n        raise Exception(f\"Failed to create deployment: {response.text}\")\n\ndeployment_id = response.json()[\"id\"]\n    print(f\"Created deployment {deployment_name} ({deployment_id})\")\n    return deployment_id\n\ndef get_deployment(deployment_id: str) -> dict:\n    \"\"\"Get deployment.\"\"\"\n    response = requests.get(\n        url=f\"{CONTROL_PLANE_HOST}/v2/deployments/{deployment_id}\",\n        headers=get_headers(),\n    )\n\nif response.status_code != 200:\n        raise Exception(f\"Failed to get deployment ID {deployment_id}: {response.text}\")\n\nreturn response.json()\n\ndef list_revisions(deployment_id: str) -> list[dict]:\n    \"\"\"List revisions.\n\nReturn list is sorted by created_at in descending order (latest first).\n    \"\"\"\n    response = requests.get(\n        url=f\"{CONTROL_PLANE_HOST}/v2/deployments/{deployment_id}/revisions\",\n        headers=get_headers(),\n    )\n\nif response.status_code != 200:\n        raise Exception(\n            f\"Failed to list revisions for deployment ID {deployment_id}: {response.text}\"\n        )\n\nreturn response.json()\n\ndef get_revision(\n    deployment_id: str,\n    revision_id: str,\n) -> dict:\n    \"\"\"Get revision.\"\"\"\n    response = requests.get(\n        url=f\"{CONTROL_PLANE_HOST}/v2/deployments/{deployment_id}/revisions/{revision_id}\",\n        headers=get_headers(),\n    )\n\nif response.status_code != 200:\n        raise Exception(f\"Failed to get revision ID {revision_id}: {response.text}\")\n\nreturn response.json()\n\ndef patch_deployment(deployment_id: str) -> None:\n    \"\"\"Patch deployment.\"\"\"\n    headers = get_headers()\n    headers[\"Content-Type\"] = \"application/json\"\n\n# This creates a new revision because source_revision_config is included\n    response = requests.patch(\n        url=f\"{CONTROL_PLANE_HOST}/v2/deployments/{deployment_id}\",\n        headers=headers,\n        json={\n            \"source_config\": {\n                \"build_on_push\": True,\n            },\n            \"source_revision_config\": {\n                \"repo_ref\": \"main\",\n                \"langgraph_config_path\": \"langgraph.json\",\n            },\n        },\n    )\n\nif response.status_code != 200:\n        raise Exception(f\"Failed to patch deployment: {response.text}\")\n\nprint(f\"Patched deployment ID {deployment_id}\")\n\ndef wait_for_deployment(deployment_id: str, revision_id: str) -> None:\n    \"\"\"Wait for revision status to be DEPLOYED.\"\"\"\n    start_time = time.time()\n    revision, status = None, None\n    while time.time() - start_time < MAX_WAIT_TIME:\n        revision = get_revision(deployment_id, revision_id)\n        status = revision[\"status\"]\n        if status == \"DEPLOYED\":\n            break\n        elif \"FAILED\" in status:\n            raise Exception(f\"Revision ID {revision_id} failed: {revision}\")\n\nprint(f\"Waiting for revision ID {revision_id} to be DEPLOYED...\")\n        time.sleep(60)\n\nif status != \"DEPLOYED\":\n        raise Exception(\n            f\"Timeout waiting for revision ID {revision_id} to be DEPLOYED: {revision}\"\n        )\n\ndef delete_deployment(deployment_id: str) -> None:\n    \"\"\"Delete deployment.\"\"\"\n    response = requests.delete(\n        url=f\"{CONTROL_PLANE_HOST}/v2/deployments/{deployment_id}\",\n        headers=get_headers(),\n    )\n\nif response.status_code != 204:\n        raise Exception(\n            f\"Failed to delete deployment ID {deployment_id}: {response.text}\"\n        )\n\nprint(f\"Deployment ID {deployment_id} deleted\")\n\nif __name__ == \"__main__\":\n    # create deployment and get the latest revision\n    deployment_id = create_deployment()\n    revisions = list_revisions(deployment_id)\n    latest_revision = revisions[\"resources\"][0]\n    latest_revision_id = latest_revision[\"id\"]\n\n# wait for latest revision to be DEPLOYED\n    wait_for_deployment(deployment_id, latest_revision_id)\n\n# patch the deployment and get the latest revision\n    patch_deployment(deployment_id)\n    revisions = list_revisions(deployment_id)\n    latest_revision = revisions[\"resources\"][0]\n    latest_revision_id = latest_revision[\"id\"]\n\n# wait for latest revision to be DEPLOYED\n    wait_for_deployment(deployment_id, latest_revision_id)\n\n# delete the deployment\n    delete_deployment(deployment_id)\n```\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/langsmith/api-ref-control-plane.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>",
  "code_samples": [],
  "headings": [],
  "url": "llms-txt#required-environment-variables",
  "links": []
}