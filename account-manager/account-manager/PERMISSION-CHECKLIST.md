# 新功能權限整合檢查清單

## 使用說明

每當新增功能時，複製此檢查清單並逐項確認完成。

---

## 功能資訊

- **功能名稱**：
- **模組名稱**：
- **負責人**：
- **日期**：

---

## 1. 權限規劃

### 1.1 權限定義

- [ ] 定義權限代碼（格式：`<模組>:<資源>:<操作>`）
  - 權限代碼：`________________`

- [ ] 確認操作類型
  - [ ] create（建立）
  - [ ] read（讀取）
  - [ ] update（更新）
  - [ ] delete（刪除）
  - [ ] manage（完整管理）

### 1.2 角色配置

決定哪些角色可存取此功能：

| 角色 | 是否授權 | 備註 |
|------|:--------:|------|
| super_admin | ☐ | |
| admin | ☐ | |
| user | ☐ | |
| guest | ☐ | |

### 1.3 更新權限矩陣

- [ ] 已更新 `docs/permission-matrix.md`
- [ ] 已在資料庫新增權限記錄

---

## 2. 前端整合

### 2.1 路由保護

- [ ] 頁面路由已加入權限檢查
- [ ] 使用 `PermissionGuard` 元件包裝

```tsx
// 範例
<PermissionGuard permission="module:resource:action">
  <YourComponent />
</PermissionGuard>
```

### 2.2 UI 元素控制

- [ ] 無權限時隱藏相關按鈕/連結
- [ ] 無權限時顯示適當提示訊息
- [ ] 導航選單已根據權限過濾

### 2.3 API 呼叫

- [ ] API 請求包含認證 Token
- [ ] 處理 401/403 錯誤回應

---

## 3. 後端整合

### 3.1 API 路由保護

- [ ] 路由已加入 `requirePermission` 中介層
- [ ] 已驗證 Token 有效性

```typescript
// 範例
router.post('/resource',
  requirePermission('module:resource:create'),
  handler
);
```

### 3.2 資料層保護

- [ ] 查詢時過濾用戶可存取的資料
- [ ] 更新/刪除時驗證資源所有權

### 3.3 日誌記錄

- [ ] 記錄權限檢查失敗事件
- [ ] 記錄敏感操作執行日誌

---

## 4. 測試驗證

### 4.1 單元測試

- [ ] 測試權限檢查邏輯
- [ ] 測試各角色的存取行為

### 4.2 整合測試

- [ ] 測試 API 權限攔截
- [ ] 測試 Token 過期處理
- [ ] 測試無權限錯誤回應

### 4.3 手動測試

- [ ] 以 super_admin 測試完整功能
- [ ] 以 admin 測試受限功能
- [ ] 以 user 測試基本功能
- [ ] 以 guest 測試公開功能
- [ ] 以未登入狀態測試重導向

---

## 5. 文件更新

- [ ] API 文件已標註所需權限
- [ ] 使用者手冊已更新
- [ ] 權限矩陣已更新

---

## 審核簽核

| 項目 | 審核人 | 日期 | 狀態 |
|------|--------|------|------|
| 權限設計 | | | ☐ 通過 |
| 程式碼審查 | | | ☐ 通過 |
| 測試報告 | | | ☐ 通過 |

---

## 備註

（填寫特殊情況或例外處理說明）
